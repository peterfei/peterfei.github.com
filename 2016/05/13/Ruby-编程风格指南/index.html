<!doctype html>



  


<html class="theme-next mist use-motion">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  <link href="/vendors/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css"/>




  <link href="//fonts.googleapis.com/css?family=Lato:300,400,700,400italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">



<link href="/vendors/font-awesome/css/font-awesome.min.css?v=4.4.0" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.0.0" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="ruby,风格指南," />





  <link rel="alternate" href="/atom.xml" title="Peterfei" type="application/atom+xml" />




  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.0.0" />






<meta name="description" content="目录
源代码排版
语法
命名
注释
注解


类与模块
异常
集合
数值
字符串
正则表达式
百分号字面量
元编程
其他
工具">
<meta property="og:type" content="article">
<meta property="og:title" content="Ruby 编程风格指南">
<meta property="og:url" content="http://peterfei.me/2016/05/13/Ruby-编程风格指南/index.html">
<meta property="og:site_name" content="Peterfei">
<meta property="og:description" content="目录
源代码排版
语法
命名
注释
注解


类与模块
异常
集合
数值
字符串
正则表达式
百分号字面量
元编程
其他
工具">
<meta property="og:updated_time" content="2022-08-26T02:42:20.303Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Ruby 编程风格指南">
<meta name="twitter:description" content="目录
源代码排版
语法
命名
注释
注解


类与模块
异常
集合
数值
字符串
正则表达式
百分号字面量
元编程
其他
工具">



<script type="text/javascript" id="hexo.configuration">
  var NexT = window.NexT || {};
  var CONFIG = {
    scheme: 'Mist',
    sidebar: '[object Object]',
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: 0,
      author: '博主'
    }
  };
</script>

  <title> Ruby 编程风格指南 | Peterfei </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  






  
  
    
  

  <div class="container one-collumn sidebar-position-left page-post-detail ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">Peterfei</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle">上主是我的牧者，我实在一无所缺</p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu menu-left">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-home fa-fw"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-archive fa-fw"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-tags fa-fw"></i> <br />
            
            标签
          </a>
        </li>
      

      
      
      
    </ul>
  

  
    <div class="site-search">
      
  <form class="site-search-form">
  <input type="text" id="st-search-input" class="st-search-input st-default-search-input" />
</form>

<script type="text/javascript">
  (function(w,d,t,u,n,s,e){w['SwiftypeObject']=n;w[n]=w[n]||function(){
    (w[n].q=w[n].q||[]).push(arguments);};s=d.createElement(t);
    e=d.getElementsByTagName(t)[0];s.async=1;s.src=u;e.parentNode.insertBefore(s,e);
  })(window,document,'script','//s.swiftypecdn.com/install/v2/st.js','_st');

  _st('install', 'PqEYgqEwUwFoXjgtngj9','2.0.0');
</script>



    </div>
  
</nav>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                Ruby 编程风格指南
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-05-13T10:39:16+08:00" content="2016-05-13">
              2016-05-13
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/Ruby/" itemprop="url" rel="index">
                    <span itemprop="name">Ruby</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/05/13/Ruby-编程风格指南/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/05/13/Ruby-编程风格指南/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        <h2 id="目录"><a href="#目录" class="headerlink" title="目录"></a>目录</h2><ul>
<li><a href="#源代码排版">源代码排版</a></li>
<li><a href="#语法">语法</a></li>
<li><a href="#命名">命名</a></li>
<li><a href="#注释">注释</a><ul>
<li><a href="#注解">注解</a></li>
</ul>
</li>
<li><a href="#类与模块">类与模块</a></li>
<li><a href="#异常">异常</a></li>
<li><a href="#集合">集合</a></li>
<li><a href="#数值">数值</a></li>
<li><a href="#字符串">字符串</a></li>
<li><a href="#正则表达式">正则表达式</a></li>
<li><a href="#百分号字面量">百分号字面量</a></li>
<li><a href="#元编程">元编程</a></li>
<li><a href="#其他">其他</a></li>
<li><a href="#工具">工具</a></li>
</ul>
<a id="more"></a>
<h2 id="源代码排版"><a href="#源代码排版" class="headerlink" title="源代码排版"></a>源代码排版</h2><blockquote>
<p>所有风格都又丑又难读，自己的除外。几乎人人都这样想。把“自己的除外”拿掉，他们或许是对的…<br><br>——Jerry Coffin（论缩排）</p>
</blockquote>
<ul>
<li><p><a name="utf-8"></a><br>使用 <code>UTF-8</code> 作为源文件的编码。<br><sup>[<a href="#utf-8">link</a>]</sup></p>
</li>
<li><p><a name="spaces-indentation"></a><br>每个缩排层级使用两个<strong>空格</strong>。不要使用制表符。<br><sup>[<a href="#spaces-indentation">link</a>]</sup></p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 差 - 四个空格</span></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">some_method</span></span></div><div class="line">    do_something</div><div class="line"><span class="keyword">end</span></div><div class="line"></div><div class="line"><span class="comment"># 好</span></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">some_method</span></span></div><div class="line">  do_something</div><div class="line"><span class="keyword">end</span></div></pre></td></tr></table></figure>
</li>
<li><p><a name="crlf"></a><br>使用 Unix 风格的换行符。（*BSD/Solaris/Linux/OS X 系统的用户不需担心，Windows 用户则要格外小心。）<br><sup>[<a href="#crlf">link</a>]</sup></p>
<ul>
<li><p>如果你使用 Git，可用下面这个配置来保护你的项目不被 Windows 的换行符干扰：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ git config --global core.autocrlf <span class="literal">true</span></div></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p><a name="no-semicolon"></a><br>不要使用 <code>;</code> 隔开语句与表达式。推论：一行一条语句。<br><sup>[<a href="#no-semicolon">link</a>]</sup></p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 差</span></div><div class="line">puts <span class="string">'foobar'</span>; <span class="comment"># 不必要的分号</span></div><div class="line"></div><div class="line">puts <span class="string">'foo'</span>; puts <span class="string">'bar'</span> <span class="comment"># 一行里有两个表达式</span></div><div class="line"></div><div class="line"><span class="comment"># 好</span></div><div class="line">puts <span class="string">'foobar'</span></div><div class="line"></div><div class="line">puts <span class="string">'foo'</span></div><div class="line">puts <span class="string">'bar'</span></div><div class="line"></div><div class="line">puts <span class="string">'foo'</span>, <span class="string">'bar'</span> <span class="comment"># 仅对 puts 适用</span></div></pre></td></tr></table></figure>
</li>
<li><p><a name="single-line-classes"></a><br>对于没有主体的类，倾向使用单行定义。<br><sup>[<a href="#single-line-classes">link</a>]</sup></p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 差</span></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">FooError</span> &lt; StandardError</span></div><div class="line"><span class="keyword">end</span></div><div class="line"></div><div class="line"><span class="comment"># 勉强可以</span></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">FooError</span> &lt; StandardError;</span> <span class="keyword">end</span></div><div class="line"></div><div class="line"><span class="comment"># 好</span></div><div class="line">FooError = Class.new(StandardError)</div></pre></td></tr></table></figure>
</li>
<li><p><a name="no-single-line-methods"></a><br>定义方法时，避免单行写法。尽管这种写法有时颇为普遍，但其略显古怪的定义语法容易使人犯错。无论如何，至少保证单行写法的方法不应该拥有一个以上的表达式。<br><sup>[<a href="#no-single-line-methods">link</a>]</sup></p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 差</span></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">too_much</span>;</span> something; something_else; <span class="keyword">end</span></div><div class="line"></div><div class="line"><span class="comment"># 勉强可以 - 注意第一个 ; 是必选的</span></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">no_braces_method</span>;</span> body <span class="keyword">end</span></div><div class="line"></div><div class="line"><span class="comment"># 勉强可以 - 注意第二个 ; 是可选的</span></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">no_braces_method</span>;</span> body; <span class="keyword">end</span></div><div class="line"></div><div class="line"><span class="comment"># 勉强可以 - 语法正确，但没有 ; 使得可读性欠佳</span></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">some_method</span><span class="params">()</span></span> body <span class="keyword">end</span></div><div class="line"></div><div class="line"><span class="comment"># 好</span></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">some_method</span></span></div><div class="line">  body</div><div class="line"><span class="keyword">end</span></div></pre></td></tr></table></figure>
<p>这个规则的一个例外是空方法。</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 好</span></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">no_op</span>;</span> <span class="keyword">end</span></div></pre></td></tr></table></figure>
</li>
<li><p><a name="spaces-operators"></a><br>操作符前后适当地添加空格，在逗号 <code>,</code>、冒号 <code>:</code> 及分号 <code>;</code> 之后。尽管 Ruby 解释器（大部分情况下）会忽略空格，但适量的空格可以增强代码的可读性。<br><sup>[<a href="#spaces-operators">link</a>]</sup></p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">sum = <span class="number">1</span> + <span class="number">2</span></div><div class="line">a, b = <span class="number">1</span>, <span class="number">2</span></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">FooError</span> &lt; StandardError;</span> <span class="keyword">end</span></div></pre></td></tr></table></figure>
<p>（对于操作符）唯一的例外是当使用指数操作符时：</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 差</span></div><div class="line">e = M * c ** <span class="number">2</span></div><div class="line"></div><div class="line"><span class="comment"># 好</span></div><div class="line">e = M * c**<span class="number">2</span></div></pre></td></tr></table></figure>
</li>
<li><p><a name="spaces-braces"></a><br><code>(</code>、<code>[</code> 之后，<code>]</code>、<code>)</code> 之前，不要添加任何空格。在 <code>{</code> 前后，在 <code>}</code> 之前添加空格。<br><sup>[<a href="#spaces-braces">link</a>]</sup></p>
</li>
</ul>
  <figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 差</span></div><div class="line">some( arg ).other</div><div class="line">[ <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span> ].each&#123;<span class="params">|e|</span> puts e&#125;</div><div class="line"></div><div class="line"><span class="comment"># 好</span></div><div class="line">some(arg).other</div><div class="line">[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>].each &#123; <span class="params">|e|</span> puts e &#125;</div></pre></td></tr></table></figure>
<p>  <code>{</code> 与 <code>}</code> 需要额外说明，因为它们可以同时用在区块、哈希字面量及字符串插值中。</p>
<p>  对于哈希字面量，有两种可被接受的风格。第一种风格更具可读性（在 Ruby 社区里似乎更为流行）。第二种风格的优点是，在视觉上使得区块与哈希字面量有所区分。无论你选择何种风格，务必在使用时保持连贯性。</p>
  <figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 好 - &#123; 之后 与 &#125; 之前有空格</span></div><div class="line">&#123; <span class="symbol">one:</span> <span class="number">1</span>, <span class="symbol">two:</span> <span class="number">2</span> &#125;</div><div class="line"></div><div class="line"><span class="comment"># 好 - &#123; 之后 与 &#125; 之前无空格</span></div><div class="line">&#123;<span class="symbol">one:</span> <span class="number">1</span>, <span class="symbol">two:</span> <span class="number">2</span>&#125;</div></pre></td></tr></table></figure>
<p>  对于插值表达式，括号内两端不要添加空格。</p>
  <figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 差</span></div><div class="line"><span class="string">"From: <span class="subst">#&#123; user.first_name &#125;</span>, <span class="subst">#&#123; user.last_name &#125;</span>"</span></div><div class="line"></div><div class="line"><span class="comment"># 好</span></div><div class="line"><span class="string">"From: <span class="subst">#&#123;user.first_name&#125;</span>, <span class="subst">#&#123;user.last_name&#125;</span>"</span></div></pre></td></tr></table></figure>
<ul>
<li><p><a name="no-space-bang"></a><br><code>!</code> 之后，不要添加任何空格。<br><sup>[<a href="#no-space-bang">link</a>]</sup></p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 差</span></div><div class="line">! something</div><div class="line"></div><div class="line"><span class="comment"># 好</span></div><div class="line">!something</div></pre></td></tr></table></figure>
</li>
<li><p><a name="no-space-inside-range-literals"></a><br>范围的字面量语法中，不要添加任何空格。<br><sup>[<a href="#no-space-inside-range-literals">link</a>]</sup></p>
  <figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 差</span></div><div class="line"><span class="number">1</span> .. <span class="number">3</span></div><div class="line"><span class="string">'a'</span> ... <span class="string">'z'</span></div><div class="line"></div><div class="line"><span class="comment"># 好</span></div><div class="line"><span class="number">1</span>..<span class="number">3</span></div><div class="line"><span class="string">'a'</span>...<span class="string">'z'</span></div></pre></td></tr></table></figure>
</li>
<li><p><a name="indent-when-to-case"></a><br>把 <code>when</code> 与 <code>case</code> 缩排在同一层级。这是《Programming Ruby》与《The Ruby Programming Language》中早已确立的风格。<br><sup>[<a href="#indent-when-to-case">link</a>]</sup></p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 差</span></div><div class="line"><span class="keyword">case</span></div><div class="line">  <span class="keyword">when</span> song.name == <span class="string">'Misty'</span></div><div class="line">    puts <span class="string">'Not again!'</span></div><div class="line">  <span class="keyword">when</span> song.duration &gt; <span class="number">120</span></div><div class="line">    puts <span class="string">'Too long!'</span></div><div class="line">  <span class="keyword">when</span> Time.now.hour &gt; <span class="number">21</span></div><div class="line">    puts <span class="string">"It's too late"</span></div><div class="line">  <span class="keyword">else</span></div><div class="line">    song.play</div><div class="line"><span class="keyword">end</span></div><div class="line"></div><div class="line"><span class="comment"># 好</span></div><div class="line"><span class="keyword">case</span></div><div class="line"><span class="keyword">when</span> song.name == <span class="string">'Misty'</span></div><div class="line">  puts <span class="string">'Not again!'</span></div><div class="line"><span class="keyword">when</span> song.duration &gt; <span class="number">120</span></div><div class="line">  puts <span class="string">'Too long!'</span></div><div class="line"><span class="keyword">when</span> Time.now.hour &gt; <span class="number">21</span></div><div class="line">  puts <span class="string">"It's too late"</span></div><div class="line"><span class="keyword">else</span></div><div class="line">  song.play</div><div class="line"><span class="keyword">end</span></div></pre></td></tr></table></figure>
</li>
<li><p><a name="indent-conditional-assignment"></a><br>当将一个条件表达式的结果赋值给一个变量时，保持分支缩排在同一层级。<br><sup>[<a href="#indent-conditional-assignment">link</a>]</sup></p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 差 - 非常费解</span></div><div class="line">kind = <span class="keyword">case</span> year</div><div class="line"><span class="keyword">when</span> <span class="number">1850</span>..<span class="number">1889</span> <span class="keyword">then</span> <span class="string">'Blues'</span></div><div class="line"><span class="keyword">when</span> <span class="number">1890</span>..<span class="number">1909</span> <span class="keyword">then</span> <span class="string">'Ragtime'</span></div><div class="line"><span class="keyword">when</span> <span class="number">1910</span>..<span class="number">1929</span> <span class="keyword">then</span> <span class="string">'New Orleans Jazz'</span></div><div class="line"><span class="keyword">when</span> <span class="number">1930</span>..<span class="number">1939</span> <span class="keyword">then</span> <span class="string">'Swing'</span></div><div class="line"><span class="keyword">when</span> <span class="number">1940</span>..<span class="number">1950</span> <span class="keyword">then</span> <span class="string">'Bebop'</span></div><div class="line"><span class="keyword">else</span> <span class="string">'Jazz'</span></div><div class="line"><span class="keyword">end</span></div><div class="line"></div><div class="line">result = <span class="keyword">if</span> some_cond</div><div class="line">  calc_something</div><div class="line"><span class="keyword">else</span></div><div class="line">  calc_something_else</div><div class="line"><span class="keyword">end</span></div><div class="line"></div><div class="line"><span class="comment"># 好 - 结构清晰</span></div><div class="line">kind = <span class="keyword">case</span> year</div><div class="line">       <span class="keyword">when</span> <span class="number">1850</span>..<span class="number">1889</span> <span class="keyword">then</span> <span class="string">'Blues'</span></div><div class="line">       <span class="keyword">when</span> <span class="number">1890</span>..<span class="number">1909</span> <span class="keyword">then</span> <span class="string">'Ragtime'</span></div><div class="line">       <span class="keyword">when</span> <span class="number">1910</span>..<span class="number">1929</span> <span class="keyword">then</span> <span class="string">'New Orleans Jazz'</span></div><div class="line">       <span class="keyword">when</span> <span class="number">1930</span>..<span class="number">1939</span> <span class="keyword">then</span> <span class="string">'Swing'</span></div><div class="line">       <span class="keyword">when</span> <span class="number">1940</span>..<span class="number">1950</span> <span class="keyword">then</span> <span class="string">'Bebop'</span></div><div class="line">       <span class="keyword">else</span> <span class="string">'Jazz'</span></div><div class="line">       <span class="keyword">end</span></div><div class="line"></div><div class="line">result = <span class="keyword">if</span> some_cond</div><div class="line">           calc_something</div><div class="line">         <span class="keyword">else</span></div><div class="line">           calc_something_else</div><div class="line">         <span class="keyword">end</span></div><div class="line"></div><div class="line"><span class="comment"># 好 - 并且更好地利用行宽</span></div><div class="line">kind =</div><div class="line">  <span class="keyword">case</span> year</div><div class="line">  <span class="keyword">when</span> <span class="number">1850</span>..<span class="number">1889</span> <span class="keyword">then</span> <span class="string">'Blues'</span></div><div class="line">  <span class="keyword">when</span> <span class="number">1890</span>..<span class="number">1909</span> <span class="keyword">then</span> <span class="string">'Ragtime'</span></div><div class="line">  <span class="keyword">when</span> <span class="number">1910</span>..<span class="number">1929</span> <span class="keyword">then</span> <span class="string">'New Orleans Jazz'</span></div><div class="line">  <span class="keyword">when</span> <span class="number">1930</span>..<span class="number">1939</span> <span class="keyword">then</span> <span class="string">'Swing'</span></div><div class="line">  <span class="keyword">when</span> <span class="number">1940</span>..<span class="number">1950</span> <span class="keyword">then</span> <span class="string">'Bebop'</span></div><div class="line">  <span class="keyword">else</span> <span class="string">'Jazz'</span></div><div class="line">  <span class="keyword">end</span></div><div class="line"></div><div class="line">result =</div><div class="line">  <span class="keyword">if</span> some_cond</div><div class="line">    calc_something</div><div class="line">  <span class="keyword">else</span></div><div class="line">    calc_something_else</div><div class="line">  <span class="keyword">end</span></div></pre></td></tr></table></figure>
</li>
<li><p><a name="empty-lines-between-methods"></a><br>在各个方法定义之间添加空行，并且将方法分成若干合乎逻辑的段落。<br><sup>[<a href="#empty-lines-between-methods">link</a>]</sup></p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">some_method</span></span></div><div class="line">  data = initialize(options)</div><div class="line"></div><div class="line">  data.manipulate!</div><div class="line"></div><div class="line">  data.result</div><div class="line"><span class="keyword">end</span></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">some_method</span></span></div><div class="line">  result</div><div class="line"><span class="keyword">end</span></div></pre></td></tr></table></figure>
</li>
<li><p><a name="no-trailing-params-comma"></a><br>避免在方法调用的最后一个参数之后添加逗号，尤其当参数没有分布在同一行时。<br><sup>[<a href="#no-trailing-params-comma">link</a>]</sup></p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 差 - 尽管移动、新增、删除参数颇为方便，但仍不推荐这种写法</span></div><div class="line">some_method(</div><div class="line">             size,</div><div class="line">             count,</div><div class="line">             color,</div><div class="line">           )</div><div class="line"></div><div class="line"><span class="comment"># 差</span></div><div class="line">some_method(size, count, color, )</div><div class="line"></div><div class="line"><span class="comment"># 好</span></div><div class="line">some_method(size, count, color)</div></pre></td></tr></table></figure>
</li>
<li><p><a name="spaces-around-equals"></a><br>当给方法的参数赋予默认值时，在 <code>=</code> 前后添加空格。<br><sup>[<a href="#spaces-around-equals">link</a>]</sup></p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 差</span></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">some_method</span><span class="params">(arg1=<span class="symbol">:default</span>, arg2=<span class="literal">nil</span>, arg3=[])</span></span></div><div class="line">  <span class="comment"># 做一些事情</span></div><div class="line"><span class="keyword">end</span></div><div class="line"></div><div class="line"><span class="comment"># 好</span></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">some_method</span><span class="params">(arg1 = <span class="symbol">:default</span>, arg2 = <span class="literal">nil</span>, arg3 = [])</span></span></div><div class="line">  <span class="comment"># 做一些事情</span></div><div class="line"><span class="keyword">end</span></div></pre></td></tr></table></figure>
<p>尽管有几本 Ruby 书籍推荐使用第一种风格，但第二种在实践中更为常见（而且似乎更具可读性）。</p>
</li>
<li><p><a name="no-trailing-backslash"></a><br>避免在非必要的情形下使用续行符 <code>\</code>。在实践中，除了字符串拼接，避免在其他任何地方使用续行。<br><sup>[<a href="#no-trailing-backslash">link</a>]</sup></p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 差</span></div><div class="line">result = <span class="number">1</span> - \</div><div class="line">         <span class="number">2</span></div><div class="line"></div><div class="line"><span class="comment"># 好 - 但仍然丑到爆</span></div><div class="line">result = <span class="number">1</span> \</div><div class="line">         - <span class="number">2</span></div><div class="line"></div><div class="line">long_string = <span class="string">'First part of the long string'</span> \</div><div class="line">              <span class="string">' and second part of the long string'</span></div></pre></td></tr></table></figure>
</li>
<li><p><a name="consistent-multi-line-chains"></a><br>使用统一的风格进行多行链式方法调用。在 Ruby 社区中存在两种流行的风格：前置 <code>.</code>（风格 A）与后置 <code>.</code>（风格 B）。<br><sup>[<a href="#consistent-multi-line-chains">link</a>]</sup></p>
<ul>
<li><p><strong>（风格 A）</strong> 当多行链式方法调用需要另起一行继续时，将 <code>.</code> 放在第二行开头。</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 差 - 需要查看第一行才能理解第二行在做什么</span></div><div class="line">one.two.three.</div><div class="line">  four</div><div class="line"></div><div class="line"><span class="comment"># 好 - 立刻能够明白第二行在做什么</span></div><div class="line">one.two.three</div><div class="line">  .four</div></pre></td></tr></table></figure>
</li>
<li><p><strong>（风格 B）</strong> 将 <code>.</code> 放在第一行末尾，以表示当前表达式尚未结束。</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 差 - 需要查看第二行才能知道链式方法调用是否结束</span></div><div class="line">one.two.three</div><div class="line">  .four</div><div class="line"></div><div class="line"><span class="comment"># 好 - 立刻能够明白第二行还有其他方法调用</span></div><div class="line">one.two.three.</div><div class="line">  four</div></pre></td></tr></table></figure>
</li>
</ul>
<p>两种风格各自优点查阅<a href="https://github.com/bbatsov/ruby-style-guide/pull/176" target="_blank" rel="external">这里</a>。</p>
</li>
<li><p><a name="no-double-indent"></a><br>当方法调用参数过长时，将它们排列在多行并对齐。若对齐后长度超过行宽限制，将首个参数位置挪到下一行进行缩排也是可以接受的。<br><sup>[<a href="#no-double-indent">link</a>]</sup></p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 初始（行太长了）</span></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">send_mail</span><span class="params">(source)</span></span></div><div class="line">  Mailer.deliver(<span class="symbol">to:</span> <span class="string">'bob@example.com'</span>, <span class="symbol">from:</span> <span class="string">'us@example.com'</span>, <span class="symbol">subject:</span> <span class="string">'Important message'</span>, <span class="symbol">body:</span> source.text)</div><div class="line"><span class="keyword">end</span></div><div class="line"></div><div class="line"><span class="comment"># 差 - 双倍缩排</span></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">send_mail</span><span class="params">(source)</span></span></div><div class="line">  Mailer.deliver(</div><div class="line">      <span class="symbol">to:</span> <span class="string">'bob@example.com'</span>,</div><div class="line">      <span class="symbol">from:</span> <span class="string">'us@example.com'</span>,</div><div class="line">      <span class="symbol">subject:</span> <span class="string">'Important message'</span>,</div><div class="line">      <span class="symbol">body:</span> source.text)</div><div class="line"><span class="keyword">end</span></div><div class="line"></div><div class="line"><span class="comment"># 好</span></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">send_mail</span><span class="params">(source)</span></span></div><div class="line">  Mailer.deliver(<span class="symbol">to:</span> <span class="string">'bob@example.com'</span>,</div><div class="line">                 <span class="symbol">from:</span> <span class="string">'us@example.com'</span>,</div><div class="line">                 <span class="symbol">subject:</span> <span class="string">'Important message'</span>,</div><div class="line">                 <span class="symbol">body:</span> source.text)</div><div class="line"><span class="keyword">end</span></div><div class="line"></div><div class="line"><span class="comment"># 好 - 普通缩排</span></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">send_mail</span><span class="params">(source)</span></span></div><div class="line">  Mailer.deliver(</div><div class="line">    <span class="symbol">to:</span> <span class="string">'bob@example.com'</span>,</div><div class="line">    <span class="symbol">from:</span> <span class="string">'us@example.com'</span>,</div><div class="line">    <span class="symbol">subject:</span> <span class="string">'Important message'</span>,</div><div class="line">    <span class="symbol">body:</span> source.text</div><div class="line">  )</div><div class="line"><span class="keyword">end</span></div></pre></td></tr></table></figure>
</li>
<li><p><a name="align-multiline-arrays"></a><br>当构建数组时，若元素跨行，应当保持对齐。<br><sup>[<a href="#align-multiline-arrays">link</a>]</sup></p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 差 - 没有对齐</span></div><div class="line">menu_item = [<span class="string">'Spam'</span>, <span class="string">'Spam'</span>, <span class="string">'Spam'</span>, <span class="string">'Spam'</span>, <span class="string">'Spam'</span>, <span class="string">'Spam'</span>, <span class="string">'Spam'</span>, <span class="string">'Spam'</span>,</div><div class="line">  <span class="string">'Baked beans'</span>, <span class="string">'Spam'</span>, <span class="string">'Spam'</span>, <span class="string">'Spam'</span>, <span class="string">'Spam'</span>, <span class="string">'Spam'</span>]</div><div class="line"></div><div class="line"><span class="comment"># 好</span></div><div class="line">menu_item = [</div><div class="line">  <span class="string">'Spam'</span>, <span class="string">'Spam'</span>, <span class="string">'Spam'</span>, <span class="string">'Spam'</span>, <span class="string">'Spam'</span>, <span class="string">'Spam'</span>, <span class="string">'Spam'</span>, <span class="string">'Spam'</span>,</div><div class="line">  <span class="string">'Baked beans'</span>, <span class="string">'Spam'</span>, <span class="string">'Spam'</span>, <span class="string">'Spam'</span>, <span class="string">'Spam'</span>, <span class="string">'Spam'</span></div><div class="line">]</div><div class="line"></div><div class="line"><span class="comment"># 好</span></div><div class="line">menu_item =</div><div class="line">  [<span class="string">'Spam'</span>, <span class="string">'Spam'</span>, <span class="string">'Spam'</span>, <span class="string">'Spam'</span>, <span class="string">'Spam'</span>, <span class="string">'Spam'</span>, <span class="string">'Spam'</span>, <span class="string">'Spam'</span>,</div><div class="line">   <span class="string">'Baked beans'</span>, <span class="string">'Spam'</span>, <span class="string">'Spam'</span>, <span class="string">'Spam'</span>, <span class="string">'Spam'</span>, <span class="string">'Spam'</span>]</div></pre></td></tr></table></figure>
</li>
<li><p><a name="underscores-in-numerics"></a><br>使用 <code>_</code> 语法改善大数的数值字面量的可读性。<br><sup>[<a href="#underscores-in-numerics">link</a>]</sup></p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 差 - 有几个零？</span></div><div class="line">num = <span class="number">1000000</span></div><div class="line"></div><div class="line"><span class="comment"># 好 - 方便人脑理解</span></div><div class="line">num = <span class="number">1_000_000</span></div></pre></td></tr></table></figure>
</li>
<li><p><a name="rdoc-conventions"></a><br>使用 [RDoc][rdoc] 及其惯例来编写 API 文档。注意，不要在注释与 <code>def</code> 之间添加空行。<br><sup>[<a href="#rdoc-conventions">link</a>]</sup></p>
</li>
<li><p><a name="80-character-limits"></a><br>将单行长度控制在 80 个字符内。<br><sup>[<a href="#80-character-limits">link</a>]</sup></p>
</li>
<li><p><a name="no-trailing-whitespace"></a><br>避免行尾空格。<br><sup>[<a href="#no-trailing-whitespace">link</a>]</sup></p>
</li>
<li><p><a name="newline-eof"></a><br>文件以空白行结束。<br><sup>[<a href="#newline-eof">link</a>]</sup></p>
</li>
<li><p><a name="no-block-comments"></a><br>不要使用区块注释。它们不能被空白字符引导，且不如常规注释容易辨认。<br><sup>[<a href="#no-block-comments">link</a>]</sup></p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 差</span></div><div class="line"><span class="comment">=begin</span></div><div class="line">comment line</div><div class="line">another comment line</div><div class="line">=end</div><div class="line"></div><div class="line"><span class="comment"># 好</span></div><div class="line"><span class="comment"># comment line</span></div><div class="line"><span class="comment"># another comment line</span></div></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="语法"><a href="#语法" class="headerlink" title="语法"></a>语法</h2><ul>
<li><p><a name="double-colons"></a><br>使用 <code>::</code> 引用常量（包括类与模块）与构造器（比如 <code>Array()</code>、<code>Nokogiri::HTML()</code>）。不要使用 <code>::</code> 调用常规方法。<br><sup>[<a href="#double-colons">link</a>]</sup></p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 差</span></div><div class="line">SomeClass::some_method</div><div class="line">some_object::some_method</div><div class="line"></div><div class="line"><span class="comment"># 好</span></div><div class="line">SomeClass.some_method</div><div class="line">some_object.some_method</div><div class="line">SomeModule::SomeClass::SOME_CONST</div><div class="line">SomeModule::SomeClass()</div></pre></td></tr></table></figure>
</li>
<li><p><a name="method-parens"></a><br>使用 <code>def</code> 定义方法时，如果有参数则使用括号，如果无参数则省略括号。<br><sup>[<a href="#method-parens">link</a>]</sup></p>
 <figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 差</span></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">some_method</span><span class="params">()</span></span></div><div class="line">  <span class="comment"># 省略主体</span></div><div class="line"><span class="keyword">end</span></div><div class="line"></div><div class="line"><span class="comment"># 好</span></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">some_method</span></span></div><div class="line">  <span class="comment"># 省略主体</span></div><div class="line"><span class="keyword">end</span></div><div class="line"></div><div class="line"><span class="comment"># 差</span></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">some_method_with_parameters</span> <span class="title">param1</span>, <span class="title">param2</span></span></div><div class="line">  <span class="comment"># 省略主体</span></div><div class="line"><span class="keyword">end</span></div><div class="line"></div><div class="line"><span class="comment"># 好</span></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">some_method_with_parameters</span><span class="params">(param1, param2)</span></span></div><div class="line">  <span class="comment"># 省略主体</span></div><div class="line"><span class="keyword">end</span></div></pre></td></tr></table></figure>
</li>
<li><p><a name="optional-arguments"></a><br>定义可选参数时，将可选参数放置在参数列表尾部。如果可选参数出现在列表头部，则此方法在调用时可能会产生预期之外的结果。<br><sup>[<a href="#optional-arguments">link</a>]</sup></p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 差</span></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">some_method</span><span class="params">(a = <span class="number">1</span>, b = <span class="number">2</span>, c, d)</span></span></div><div class="line">  puts <span class="string">"<span class="subst">#&#123;a&#125;</span>, <span class="subst">#&#123;b&#125;</span>, <span class="subst">#&#123;c&#125;</span>, <span class="subst">#&#123;d&#125;</span>"</span></div><div class="line"><span class="keyword">end</span></div><div class="line"></div><div class="line">some_method(<span class="string">'w'</span>, <span class="string">'x'</span>) <span class="comment"># =&gt; '1, 2, w, x'</span></div><div class="line">some_method(<span class="string">'w'</span>, <span class="string">'x'</span>, <span class="string">'y'</span>) <span class="comment"># =&gt; 'w, 2, x, y'</span></div><div class="line">some_method(<span class="string">'w'</span>, <span class="string">'x'</span>, <span class="string">'y'</span>, <span class="string">'z'</span>) <span class="comment"># =&gt; 'w, x, y, z'</span></div><div class="line"></div><div class="line"><span class="comment"># 好</span></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">some_method</span><span class="params">(c, d, a = <span class="number">1</span>, b = <span class="number">2</span>)</span></span></div><div class="line">  puts <span class="string">"<span class="subst">#&#123;a&#125;</span>, <span class="subst">#&#123;b&#125;</span>, <span class="subst">#&#123;c&#125;</span>, <span class="subst">#&#123;d&#125;</span>"</span></div><div class="line"><span class="keyword">end</span></div><div class="line"></div><div class="line">some_method(<span class="string">'w'</span>, <span class="string">'x'</span>) <span class="comment"># =&gt; '1, 2, w, x'</span></div><div class="line">some_method(<span class="string">'w'</span>, <span class="string">'x'</span>, <span class="string">'y'</span>) <span class="comment"># =&gt; 'y, 2, w, x'</span></div><div class="line">some_method(<span class="string">'w'</span>, <span class="string">'x'</span>, <span class="string">'y'</span>, <span class="string">'z'</span>) <span class="comment"># =&gt; 'y, z, w, x'</span></div></pre></td></tr></table></figure>
</li>
<li><p><a name="parallel-assignment"></a><br>定义变量时，避免并行赋值。但当右值为方法调用返回值，或是与 <code>*</code> 操作符配合使用，或是交换两个变量的值，并行赋值也是可以接受的。并行赋值的可读性通常不如分开赋值。<br><sup>[<a href="#parallel-assignment">link</a>]</sup></p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 差</span></div><div class="line">a, b, c, d = <span class="string">'foo'</span>, <span class="string">'bar'</span>, <span class="string">'baz'</span>, <span class="string">'foobar'</span></div><div class="line"></div><div class="line"><span class="comment"># 好</span></div><div class="line">a = <span class="string">'foo'</span></div><div class="line">b = <span class="string">'bar'</span></div><div class="line">c = <span class="string">'baz'</span></div><div class="line">d = <span class="string">'foobar'</span></div><div class="line"></div><div class="line"><span class="comment"># 好 - 交换两个变量的值</span></div><div class="line">a = <span class="string">'foo'</span></div><div class="line">b = <span class="string">'bar'</span></div><div class="line"></div><div class="line">a, b = b, a</div><div class="line">puts a <span class="comment"># =&gt; 'bar'</span></div><div class="line">puts b <span class="comment"># =&gt; 'foo'</span></div><div class="line"></div><div class="line"><span class="comment"># 好 - 右值为方法调用返回值</span></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">multi_return</span></span></div><div class="line">  [<span class="number">1</span>, <span class="number">2</span>]</div><div class="line"><span class="keyword">end</span></div><div class="line"></div><div class="line">first, second = multi_return</div><div class="line"></div><div class="line"><span class="comment"># 好 - 与 * 操作符配合使用</span></div><div class="line">first, *list = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>] <span class="comment"># first =&gt; 1, list =&gt; [2, 3, 4]</span></div><div class="line"></div><div class="line">hello_array = *<span class="string">'Hello'</span> <span class="comment"># =&gt; ["Hello"]</span></div><div class="line"></div><div class="line">a = *(<span class="number">1</span>..<span class="number">3</span>) <span class="comment"># =&gt; [1, 2, 3]</span></div></pre></td></tr></table></figure>
</li>
<li><p><a name="trailing-underscore-variables"></a><br>除非必要，否则避免在并行赋值时使用单字符的 <code>_</code> 变量。优先考虑前缀形式的下划线变量，而不是直接使用 <code>_</code>，因为前者可以提供一定的语义信息。但当赋值语句左侧出现带 <code>*</code> 操作符的变量时，使用 <code>_</code> 也是可以接受的。<br><sup><a href="#trailing-underscore-variables">[link]</a></sup></p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">foo = <span class="string">'one,two,three,four,five'</span></div><div class="line"></div><div class="line"><span class="comment"># 差 - 可有可无，且无任何有用信息</span></div><div class="line">first, second, <span class="number">_</span> = foo.split(<span class="string">','</span>)</div><div class="line">first, <span class="number">_</span>, <span class="number">_</span> = foo.split(<span class="string">','</span>)</div><div class="line">first, *<span class="number">_</span> = foo.split(<span class="string">','</span>)</div><div class="line"></div><div class="line"><span class="comment"># 好</span></div><div class="line">a, = foo.split(<span class="string">','</span>)</div><div class="line">a, b, = foo.split(<span class="string">','</span>)</div><div class="line"></div><div class="line"><span class="comment"># 好 - 可有可无，但提供了额外信息</span></div><div class="line">first, _second = foo.split(<span class="string">','</span>)</div><div class="line">first, _second, = foo.split(<span class="string">','</span>)</div><div class="line">first, *_ending = foo.split(<span class="string">','</span>)</div><div class="line"></div><div class="line"><span class="comment"># 好 - 占位符，_ 担当最后一个元素</span></div><div class="line">*beginning, <span class="number">_</span> = foo.split(<span class="string">','</span>)</div><div class="line">*beginning, something, <span class="number">_</span> = foo.split(<span class="string">','</span>)</div></pre></td></tr></table></figure>
</li>
<li><p><a name="no-for-loops"></a><br>永远不要使用 <code>for</code>， 除非你很清楚为什么。大部分情况下，你应该使用迭代器。<code>for</code> 是由 <code>each</code> 实现的，所以你绕弯了。另外，<code>for</code> 没有引入一个新的作用域 (<code>each</code> 有），因此在它内部定义的变量在外部仍是可见的。<br><sup>[<a href="#no-for-loops">link</a>]</sup></p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">arr = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]</div><div class="line"></div><div class="line"><span class="comment"># 差</span></div><div class="line"><span class="keyword">for</span> elem <span class="keyword">in</span> arr <span class="keyword">do</span></div><div class="line">  puts elem</div><div class="line"><span class="keyword">end</span></div><div class="line"></div><div class="line"><span class="comment"># 注意，elem 可在 for 循环外部被访问</span></div><div class="line">elem <span class="comment"># =&gt; 3</span></div><div class="line"></div><div class="line"><span class="comment"># 好</span></div><div class="line">arr.each &#123; <span class="params">|elem|</span> puts elem &#125;</div><div class="line"></div><div class="line"><span class="comment"># 注意，elem 不可在 each 块外部被访问</span></div><div class="line">elem <span class="comment"># =&gt; NameError: undefined local variable or method `elem'</span></div></pre></td></tr></table></figure>
</li>
<li><p><a name="no-then"></a><br>永远不要在多行 <code>if/unless</code> 中使用 <code>then</code>。<br><sup>[<a href="#no-then">link</a>]</sup></p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 差</span></div><div class="line"><span class="keyword">if</span> some_condition <span class="keyword">then</span></div><div class="line">  <span class="comment"># 省略主体</span></div><div class="line"><span class="keyword">end</span></div><div class="line"></div><div class="line"><span class="comment"># 好</span></div><div class="line"><span class="keyword">if</span> some_condition</div><div class="line">  <span class="comment"># 省略主体</span></div><div class="line"><span class="keyword">end</span></div></pre></td></tr></table></figure>
</li>
<li><p><a name="same-line-condition"></a><br>在多行 <code>if/unless</code> 中，总是把条件表达式与 <code>if/unless</code> 放置在同一行。<br><sup>[<a href="#same-line-condition">link</a>]</sup></p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 差</span></div><div class="line"><span class="keyword">if</span></div><div class="line">  some_condition</div><div class="line">  do_something</div><div class="line">  do_something_else</div><div class="line"><span class="keyword">end</span></div><div class="line"></div><div class="line"><span class="comment"># 好</span></div><div class="line"><span class="keyword">if</span> some_condition</div><div class="line">  do_something</div><div class="line">  do_something_else</div><div class="line"><span class="keyword">end</span></div></pre></td></tr></table></figure>
</li>
<li><p><a name="ternary-operator"></a><br>倾向使用三元操作符（<code>?:</code>）而不是 <code>if/then/else/end</code> 结构。前者更为常见且简练。<br><sup>[<a href="#ternary-operator">link</a>]</sup></p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 差</span></div><div class="line">result = <span class="keyword">if</span> some_condition <span class="keyword">then</span> something <span class="keyword">else</span> something_else <span class="keyword">end</span></div><div class="line"></div><div class="line"><span class="comment"># 好</span></div><div class="line">result = some_condition ? something : something_else</div></pre></td></tr></table></figure>
</li>
<li><p><a name="no-nested-ternary"></a><br>三元操作符的每个分支只写一个表达式。即不要嵌套三元操作符。嵌套情况请使用 <code>if/else</code> 结构。<br><sup>[<a href="#no-nested-ternary">link</a>]</sup></p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 差</span></div><div class="line">some_condition ? (nested_condition ? nested_something : nested_something_else) : something_else</div><div class="line"></div><div class="line"><span class="comment"># 好</span></div><div class="line"><span class="keyword">if</span> some_condition</div><div class="line">  nested_condition ? nested_something : nested_something_else</div><div class="line"><span class="keyword">else</span></div><div class="line">  something_else</div><div class="line"><span class="keyword">end</span></div></pre></td></tr></table></figure>
</li>
<li><p><a name="no-semicolon-ifs"></a><br>永远不要使用 <code>if x; ...</code>。使用三元操作符来替代。<br><sup>[<a href="#no-semicolon-ifs">link</a>]</sup></p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 差</span></div><div class="line">result = <span class="keyword">if</span> some_condition; something <span class="keyword">else</span> something_else <span class="keyword">end</span></div><div class="line"></div><div class="line"><span class="comment"># 好</span></div><div class="line">result = some_condition ? something : something_else</div></pre></td></tr></table></figure>
</li>
<li><p><a name="use-if-case-returns"></a><br>利用“<code>if</code> 与 <code>case</code> 是表达式”的这个特性。<br><sup>[<a href="#use-if-case-returns">link</a>]</sup></p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 差</span></div><div class="line"><span class="keyword">if</span> condition</div><div class="line">  result = x</div><div class="line"><span class="keyword">else</span></div><div class="line">  result = y</div><div class="line"><span class="keyword">end</span></div><div class="line"></div><div class="line"><span class="comment"># 好</span></div><div class="line">result =</div><div class="line">  <span class="keyword">if</span> condition</div><div class="line">    x</div><div class="line">  <span class="keyword">else</span></div><div class="line">    y</div><div class="line">  <span class="keyword">end</span></div></pre></td></tr></table></figure>
</li>
<li><p><a name="one-line-cases"></a><br>在 <code>case</code> 表达式中，单行情况使用 <code>when x then ...</code> 语法。另一种语法 <code>when x: ...</code> 在 Ruby 1.9 之后被移除了。<br><sup>[<a href="#one-line-cases">link</a>]</sup></p>
</li>
<li><p><a name="no-when-semicolons"></a><br>不要使用 <code>when x; ...</code> 语法。参考前一条规则。<br><sup>[<a href="#no-when-semicolons">link</a>]</sup></p>
</li>
<li><p><a name="bang-not-not"></a><br>使用 <code>!</code> 而不是 <code>not</code>。<br><sup>[<a href="#bang-not-not">link</a>]</sup></p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 差 - 因为操作符的优先级，这里必须使用括号</span></div><div class="line">x = (<span class="keyword">not</span> something)</div><div class="line"></div><div class="line"><span class="comment"># 好</span></div><div class="line">x = !something</div></pre></td></tr></table></figure>
</li>
<li><p><a name="no-bang-bang"></a><br>避免使用 <code>!!</code>。<br><sup>[<a href="#no-bang-bang">link</a>]</sup></p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 差</span></div><div class="line">x = <span class="string">'test'</span></div><div class="line"><span class="comment"># 令人费解的 nil 检查</span></div><div class="line"><span class="keyword">if</span> !!x</div><div class="line">  <span class="comment"># 省略主体</span></div><div class="line"><span class="keyword">end</span></div><div class="line"></div><div class="line">x = <span class="literal">false</span></div><div class="line"><span class="comment"># 对于布尔变量，双重否定是多余的</span></div><div class="line">!!x <span class="comment"># =&gt; false</span></div><div class="line"></div><div class="line"><span class="comment"># 好</span></div><div class="line">x = <span class="string">'test'</span></div><div class="line">unless x.<span class="literal">nil</span>?</div><div class="line">  <span class="comment"># 省略主体</span></div><div class="line"><span class="keyword">end</span></div></pre></td></tr></table></figure>
</li>
<li><p><a name="no-and-or-or"></a><br>永远不要使用 <code>and</code> 与 <code>or</code> 关键字。使用 <code>&amp;&amp;</code> 与 <code>||</code> 来替代。<br><sup>[<a href="#no-and-or-or">link</a>]</sup></p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 差</span></div><div class="line"><span class="comment"># 布尔表达式</span></div><div class="line"><span class="keyword">if</span> some_condition <span class="keyword">and</span> some_other_condition</div><div class="line">  do_something</div><div class="line"><span class="keyword">end</span></div><div class="line"></div><div class="line"><span class="comment"># 流程控制</span></div><div class="line">document.saved? <span class="keyword">or</span> document.save!</div><div class="line"></div><div class="line"><span class="comment"># 好</span></div><div class="line"><span class="comment"># 布尔表达式</span></div><div class="line"><span class="keyword">if</span> some_condition &amp;&amp; some_other_condition</div><div class="line">  do_something</div><div class="line"><span class="keyword">end</span></div><div class="line"></div><div class="line"><span class="comment"># 流程控制</span></div><div class="line">document.saved? <span class="params">||</span> document.save!</div></pre></td></tr></table></figure>
</li>
<li><p><a name="no-multiline-ternary"></a><br>避免使用多行三元操作符（<code>?:</code>）。使用 <code>if/unless</code> 来替代。<br><sup>[<a href="#no-multiline-ternary">link</a>]</sup></p>
</li>
<li><p><a name="if-as-a-modifier"></a><br>对于单行主体，倾向使用 <code>if/unless</code> 修饰语法。另一种方法是使用流程控制 <code>&amp;&amp;/||</code>。<br><sup>[<a href="#if-as-a-modifier">link</a>]</sup></p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 差</span></div><div class="line"><span class="keyword">if</span> some_condition</div><div class="line">  do_something</div><div class="line"><span class="keyword">end</span></div><div class="line"></div><div class="line"><span class="comment"># 好</span></div><div class="line">do_something <span class="keyword">if</span> some_condition</div><div class="line"></div><div class="line"><span class="comment"># 好 - 使用流程控制</span></div><div class="line">some_condition &amp;&amp; do_something</div></pre></td></tr></table></figure>
</li>
<li><p><a name="no-multiline-if-modifiers"></a><br>避免在多行区块后使用 <code>if/unless</code> 修饰语法。<br><sup>[<a href="#no-multiline-if-modifiers">link</a>]</sup></p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 差</span></div><div class="line"><span class="number">10</span>.times <span class="keyword">do</span></div><div class="line">  <span class="comment"># 省略多行主体</span></div><div class="line"><span class="keyword">end</span> <span class="keyword">if</span> some_condition</div><div class="line"></div><div class="line"><span class="comment"># 好</span></div><div class="line"><span class="keyword">if</span> some_condition</div><div class="line">  <span class="number">10</span>.times <span class="keyword">do</span></div><div class="line">    <span class="comment"># 省略多行主体</span></div><div class="line">  <span class="keyword">end</span></div><div class="line"><span class="keyword">end</span></div></pre></td></tr></table></figure>
</li>
<li><p><a name="no-nested-modifiers"></a><br>避免使用嵌套 <code>if/unless/while/until</code> 修饰语法。适当情况下，使用 <code>&amp;&amp;/||</code> 来替代。<br><sup>[<a href="#no-nested-modifiers">link</a>]</sup></p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 差</span></div><div class="line">do_something <span class="keyword">if</span> other_condition <span class="keyword">if</span> some_condition</div><div class="line"></div><div class="line"><span class="comment"># 好</span></div><div class="line">do_something <span class="keyword">if</span> some_condition &amp;&amp; other_condition</div></pre></td></tr></table></figure>
</li>
<li><p><a name="unless-for-negatives"></a><br>对于否定条件，倾向使用 <code>unless</code> 而不是 <code>if</code>（或是使用流程控制 <code>||</code>）。<br><sup>[<a href="#unless-for-negatives">link</a>]</sup></p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 差</span></div><div class="line">do_something <span class="keyword">if</span> !some_condition</div><div class="line"></div><div class="line"><span class="comment"># 差</span></div><div class="line">do_something <span class="keyword">if</span> <span class="keyword">not</span> some_condition</div><div class="line"></div><div class="line"><span class="comment"># 好</span></div><div class="line">do_something unless some_condition</div><div class="line"></div><div class="line"><span class="comment"># 好</span></div><div class="line">some_condition <span class="params">||</span> do_something</div></pre></td></tr></table></figure>
</li>
<li><p><a name="no-else-with-unless"></a><br>不要使用 <code>unless</code> 与 <code>else</code> 的组合。将它们改写成肯定条件。<br><sup>[<a href="#no-else-with-unless">link</a>]</sup></p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 差</span></div><div class="line">unless success?</div><div class="line">  puts <span class="string">'failure'</span></div><div class="line"><span class="keyword">else</span></div><div class="line">  puts <span class="string">'success'</span></div><div class="line"><span class="keyword">end</span></div><div class="line"></div><div class="line"><span class="comment"># 好</span></div><div class="line"><span class="keyword">if</span> success?</div><div class="line">  puts <span class="string">'success'</span></div><div class="line"><span class="keyword">else</span></div><div class="line">  puts <span class="string">'failure'</span></div><div class="line"><span class="keyword">end</span></div></pre></td></tr></table></figure>
</li>
<li><p><a name="no-parens-if"></a><br>不要使用括号包裹 <code>if/unless/while/until</code> 的条件表达式。<br><sup>[<a href="#no-parens-if">link</a>]</sup></p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 差</span></div><div class="line"><span class="keyword">if</span> (x &gt; <span class="number">10</span>)</div><div class="line">  <span class="comment"># 省略主体</span></div><div class="line"><span class="keyword">end</span></div><div class="line"></div><div class="line"><span class="comment"># 好</span></div><div class="line"><span class="keyword">if</span> x &gt; <span class="number">10</span></div><div class="line">  <span class="comment"># 省略主体</span></div><div class="line"><span class="keyword">end</span></div></pre></td></tr></table></figure>
<p>这个规则的一个例外是<a href="#safe-assignment-in-condition">条件表达式中的安全赋值</a>。</p>
</li>
<li><p><a name="no-multiline-while-do"></a><br>在多行 <code>while/until</code> 中，不要使用 <code>while/until condition do</code>。<br><sup>[<a href="#no-multiline-while-do">link</a>]</sup></p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 差</span></div><div class="line"><span class="keyword">while</span> x &gt; <span class="number">5</span> <span class="keyword">do</span></div><div class="line">  <span class="comment"># 省略主体</span></div><div class="line"><span class="keyword">end</span></div><div class="line"></div><div class="line"><span class="keyword">until</span> x &gt; <span class="number">5</span> <span class="keyword">do</span></div><div class="line">  <span class="comment"># 省略主体</span></div><div class="line"><span class="keyword">end</span></div><div class="line"></div><div class="line"><span class="comment"># 好</span></div><div class="line"><span class="keyword">while</span> x &gt; <span class="number">5</span></div><div class="line">  <span class="comment"># 省略主体</span></div><div class="line"><span class="keyword">end</span></div><div class="line"></div><div class="line"><span class="keyword">until</span> x &gt; <span class="number">5</span></div><div class="line">  <span class="comment"># 省略主体</span></div><div class="line"><span class="keyword">end</span></div></pre></td></tr></table></figure>
</li>
<li><p><a name="while-as-a-modifier"></a><br>对于单行主体，倾向使用 <code>while/until</code> 修饰语法。<br><sup>[<a href="#while-as-a-modifier">link</a>]</sup></p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 差</span></div><div class="line"><span class="keyword">while</span> some_condition</div><div class="line">  do_something</div><div class="line"><span class="keyword">end</span></div><div class="line"></div><div class="line"><span class="comment"># 好</span></div><div class="line">do_something <span class="keyword">while</span> some_condition</div></pre></td></tr></table></figure>
</li>
<li><p><a name="until-for-negatives"></a><br>对于否定条件，倾向使用 <code>until</code> 而不是 <code>while</code>。<br><sup>[<a href="#until-for-negatives">link</a>]</sup></p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 差</span></div><div class="line">do_something <span class="keyword">while</span> !some_condition</div><div class="line"></div><div class="line"><span class="comment"># 好</span></div><div class="line">do_something <span class="keyword">until</span> some_condition</div></pre></td></tr></table></figure>
</li>
<li><p><a name="infinite-loop"></a><br>对于无限循环，使用 <code>Kernel#loop</code> 而不是 <code>while/until</code>。<br><sup>[<a href="#infinite-loop">link</a>]</sup></p>
  <figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 差</span></div><div class="line"><span class="keyword">while</span> <span class="literal">true</span></div><div class="line">  do_something</div><div class="line"><span class="keyword">end</span></div><div class="line"></div><div class="line"><span class="keyword">until</span> <span class="literal">false</span></div><div class="line">  do_something</div><div class="line"><span class="keyword">end</span></div><div class="line"></div><div class="line"><span class="comment"># 好</span></div><div class="line">loop <span class="keyword">do</span></div><div class="line">  do_something</div><div class="line"><span class="keyword">end</span></div></pre></td></tr></table></figure>
</li>
<li><p><a name="loop-with-break"></a><br>对于后置条件循环语句，倾向使用 <code>Kernel#loop</code> 与 <code>break</code> 的组合，而不是 <code>begin/end/until</code> 或 <code>begin/end/while</code>。<br><sup>[<a href="#loop-with-break">link</a>]</sup></p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 差</span></div><div class="line"><span class="keyword">begin</span></div><div class="line">  puts val</div><div class="line">  val += <span class="number">1</span></div><div class="line"><span class="keyword">end</span> <span class="keyword">while</span> val &lt; <span class="number">0</span></div><div class="line"></div><div class="line"><span class="comment"># 好</span></div><div class="line">loop <span class="keyword">do</span></div><div class="line">  puts val</div><div class="line">  val += <span class="number">1</span></div><div class="line">  <span class="keyword">break</span> unless val &lt; <span class="number">0</span></div><div class="line"><span class="keyword">end</span></div></pre></td></tr></table></figure>
</li>
<li><p><a name="no-dsl-parens"></a><br>对于 DSL 的内部方法（比如 Rake、Rails、RSpec）、具有“关键字”特性的内部方法（比如 <code>attr_reader</code>、<code>puts</code>）、以及属性存取方法，省略这些方法外围的括号。所有其他的方法调用则使用括号。<br><sup>[<a href="#no-dsl-parens">link</a>]</sup></p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span></span></div><div class="line">  <span class="keyword">attr_reader</span>(<span class="symbol">:name</span>, <span class="symbol">:age</span>)  <span class="comment"># 差</span></div><div class="line">  <span class="keyword">attr_reader</span> <span class="symbol">:name</span>, <span class="symbol">:age</span>   <span class="comment"># 好</span></div><div class="line"></div><div class="line">  <span class="comment"># 省略主体</span></div><div class="line"><span class="keyword">end</span></div><div class="line"></div><div class="line">temperance = Person.new <span class="string">'Temperance'</span>, <span class="number">30</span>  <span class="comment"># 差</span></div><div class="line">temperance = Person.new(<span class="string">'Temperance'</span>, <span class="number">30</span>) <span class="comment"># 好</span></div><div class="line"></div><div class="line">puts(temperance.age)  <span class="comment"># 差</span></div><div class="line">puts temperance.age   <span class="comment"># 好</span></div><div class="line"></div><div class="line">x = Math.sin y  <span class="comment"># 差</span></div><div class="line">x = Math.sin(y) <span class="comment"># 好</span></div><div class="line"></div><div class="line">array.delete e  <span class="comment"># 差</span></div><div class="line">array.delete(e) <span class="comment"># 好</span></div><div class="line"></div><div class="line">expect(bowling.score).to eq <span class="number">0</span>   <span class="comment"># 差</span></div><div class="line">expect(bowling.score).to eq(<span class="number">0</span>)  <span class="comment"># 好</span></div></pre></td></tr></table></figure>
</li>
<li><p><a name="no-braces-opts-hash"></a><br>对于可选参数的哈希，省略其外围的花括号。<br><sup>[<a href="#no-braces-opts-hash">link</a>]</sup></p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 差</span></div><div class="line">user.set(&#123; <span class="symbol">name:</span> <span class="string">'John'</span>, <span class="symbol">age:</span> <span class="number">45</span>, <span class="symbol">permissions:</span> &#123; <span class="symbol">read:</span> <span class="literal">true</span> &#125; &#125;)</div><div class="line"></div><div class="line"><span class="comment"># 好</span></div><div class="line">user.set(<span class="symbol">name:</span> <span class="string">'John'</span>, <span class="symbol">age:</span> <span class="number">45</span>, <span class="symbol">permissions:</span> &#123; <span class="symbol">read:</span> <span class="literal">true</span> &#125;)</div></pre></td></tr></table></figure>
</li>
<li><p><a name="no-dsl-decorating"></a><br>对于 DSL 的内部方法调用，同时省略其外围的圆括号与花括号。<br><sup>[<a href="#no-dsl-decorating">link</a>]</sup></p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span> &lt; ActiveRecord::Base</span></div><div class="line">  <span class="comment"># 差</span></div><div class="line">  validates(<span class="symbol">:name</span>, &#123; <span class="symbol">presence:</span> <span class="literal">true</span>, <span class="symbol">length:</span> &#123; <span class="symbol">within:</span> <span class="number">1</span>..<span class="number">10</span> &#125; &#125;)</div><div class="line"></div><div class="line">  <span class="comment"># 好</span></div><div class="line">  validates <span class="symbol">:name</span>, <span class="symbol">presence:</span> <span class="literal">true</span>, <span class="symbol">length:</span> &#123; <span class="symbol">within:</span> <span class="number">1</span>..<span class="number">10</span> &#125;</div><div class="line"><span class="keyword">end</span></div></pre></td></tr></table></figure>
</li>
<li><p><a name="no-args-no-parens"></a><br>无参调用方法时，省略括号。<br><sup>[<a href="#no-args-no-parens">link</a>]</sup></p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 差</span></div><div class="line">Kernel.exit!()</div><div class="line"><span class="number">2</span>.even?()</div><div class="line">fork()</div><div class="line"><span class="string">'test'</span>.upcase()</div><div class="line"></div><div class="line"><span class="comment"># 好</span></div><div class="line">Kernel.exit!</div><div class="line"><span class="number">2</span>.even?</div><div class="line">fork</div><div class="line"><span class="string">'test'</span>.upcase</div></pre></td></tr></table></figure>
</li>
<li><p><a name="single-action-blocks"></a><br>当被调用方法是当前区块中唯一操作时，倾向使用简短的传参语法。<br><sup>[<a href="#single-action-blocks">link</a>]</sup></p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 差</span></div><div class="line">names.map &#123; <span class="params">|name|</span> name.upcase &#125;</div><div class="line"></div><div class="line"><span class="comment"># 好</span></div><div class="line">names.map(&amp;<span class="symbol">:upcase</span>)</div></pre></td></tr></table></figure>
</li>
<li><p><a name="single-line-blocks"></a><br>对于单行主体，倾向使用 <code>{...}</code> 而不是 <code>do...end</code>。对于多行主体，避免使用 <code>{...}</code>。对于“流程控制”或“方法定义”（比如 Rakefile、其他 DSL 构成片段），总是使用 <code>do...end</code>。避免在链式方法调用中使用 <code>do...end</code>。<br><sup>[<a href="#single-line-blocks">link</a>]</sup></p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">names = <span class="string">%w(Bozhidar Steve Sarah)</span></div><div class="line"></div><div class="line"><span class="comment"># 差</span></div><div class="line">names.each <span class="keyword">do</span> <span class="params">|name|</span></div><div class="line">  puts name</div><div class="line"><span class="keyword">end</span></div><div class="line"></div><div class="line"><span class="comment"># 好</span></div><div class="line">names.each &#123; <span class="params">|name|</span> puts name &#125;</div><div class="line"></div><div class="line"><span class="comment"># 差</span></div><div class="line">names.select <span class="keyword">do</span> <span class="params">|name|</span></div><div class="line">  name.start_with?(<span class="string">'S'</span>)</div><div class="line"><span class="keyword">end</span>.map &#123; <span class="params">|name|</span> name.upcase &#125;</div><div class="line"></div><div class="line"><span class="comment"># 好</span></div><div class="line">names.select &#123; <span class="params">|name|</span> name.start_with?(<span class="string">'S'</span>) &#125;.map(&amp;<span class="symbol">:upcase</span>)</div></pre></td></tr></table></figure>
<p>某些人可能会争论在多行链式方法调用时使用 <code>{...}</code> 看起来还可以。但他们应该扪心自问——这样的代码真的可读吗？难道不能把区块内容提取出来放到小巧的方法里吗？</p>
</li>
<li><p><a name="block-argument"></a><br>优先考虑使用显式区块参数，以避免某些情况下通过创建区块的手法来传递参数给其他区块。此规则对性能有所影响，因为区块会被转换为 <code>Proc</code> 对象。<br><sup>[<a href="#block-argument">link</a>]</sup></p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">require</span> <span class="string">'tempfile'</span></div><div class="line"></div><div class="line"><span class="comment"># 差</span></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">with_tmp_dir</span></span></div><div class="line">  Dir.mktmpdir <span class="keyword">do</span> <span class="params">|tmp_dir|</span></div><div class="line">    Dir.chdir(tmp_dir) &#123; <span class="params">|dir|</span> <span class="keyword">yield</span> dir &#125;  <span class="comment"># 通过创建区块的手法来传递参数</span></div><div class="line">  <span class="keyword">end</span></div><div class="line"><span class="keyword">end</span></div><div class="line"></div><div class="line"><span class="comment"># 好</span></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">with_tmp_dir</span><span class="params">(&amp;block)</span></span></div><div class="line">  Dir.mktmpdir <span class="keyword">do</span> <span class="params">|tmp_dir|</span></div><div class="line">    Dir.chdir(tmp_dir, &amp;block)</div><div class="line">  <span class="keyword">end</span></div><div class="line"><span class="keyword">end</span></div><div class="line"></div><div class="line">with_tmp_dir <span class="keyword">do</span> <span class="params">|dir|</span></div><div class="line">  puts <span class="string">"dir is accessible as a parameter and pwd is set: <span class="subst">#&#123;dir&#125;</span>"</span></div><div class="line"><span class="keyword">end</span></div></pre></td></tr></table></figure>
</li>
<li><p><a name="no-explicit-return"></a><br>避免在不需要流程控制的情况下使用 <code>return</code>。<br><sup>[<a href="#no-explicit-return">link</a>]</sup></p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 差</span></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">some_method</span><span class="params">(some_arr)</span></span></div><div class="line">  <span class="keyword">return</span> some_arr.size</div><div class="line"><span class="keyword">end</span></div><div class="line"></div><div class="line"><span class="comment"># 好</span></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">some_method</span><span class="params">(some_arr)</span></span></div><div class="line">  some_arr.size</div><div class="line"><span class="keyword">end</span></div></pre></td></tr></table></figure>
</li>
<li><p><a name="no-self-unless-required"></a><br>避免在不需要的情况下使用 <code>self</code>。（只有在调用 <code>self</code> 的修改器时才需要）<br><sup>[<a href="#no-self-unless-required">link</a>]</sup></p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 差</span></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">ready?</span></span></div><div class="line">  <span class="keyword">if</span> <span class="keyword">self</span>.last_reviewed_at &gt; <span class="keyword">self</span>.last_updated_at</div><div class="line">    <span class="keyword">self</span>.worker.update(<span class="keyword">self</span>.content, <span class="keyword">self</span>.options)</div><div class="line">    <span class="keyword">self</span>.status = <span class="symbol">:in_progress</span></div><div class="line">  <span class="keyword">end</span></div><div class="line">  <span class="keyword">self</span>.status == <span class="symbol">:verified</span></div><div class="line"><span class="keyword">end</span></div><div class="line"></div><div class="line"><span class="comment"># 好</span></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">ready?</span></span></div><div class="line">  <span class="keyword">if</span> last_reviewed_at &gt; last_updated_at</div><div class="line">    worker.update(content, options)</div><div class="line">    <span class="keyword">self</span>.status = <span class="symbol">:in_progress</span></div><div class="line">  <span class="keyword">end</span></div><div class="line">  status == <span class="symbol">:verified</span></div><div class="line"><span class="keyword">end</span></div></pre></td></tr></table></figure>
</li>
<li><p><a name="no-shadowing"></a><br>避免局部变量遮蔽方法调用，除非它们具有相同效果。<br><sup>[<a href="#no-shadowing">link</a>]</sup></p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Foo</span></span></div><div class="line">  <span class="keyword">attr_accessor</span> <span class="symbol">:options</span></div><div class="line"></div><div class="line">  <span class="comment"># 勉强可以</span></div><div class="line">  <span class="function"><span class="keyword">def</span> <span class="title">initialize</span><span class="params">(options)</span></span></div><div class="line">    <span class="keyword">self</span>.options = options</div><div class="line">    <span class="comment"># 此处 self.options 与 options 具有相同效果</span></div><div class="line">  <span class="keyword">end</span></div><div class="line"></div><div class="line">  <span class="comment"># 差</span></div><div class="line">  <span class="function"><span class="keyword">def</span> <span class="title">do_something</span><span class="params">(options = &#123;&#125;)</span></span></div><div class="line">    unless options[<span class="symbol">:when</span>] == <span class="symbol">:later</span></div><div class="line">      output(<span class="keyword">self</span>.options[<span class="symbol">:message</span>])</div><div class="line">    <span class="keyword">end</span></div><div class="line">  <span class="keyword">end</span></div><div class="line"></div><div class="line">  <span class="comment"># 好</span></div><div class="line">  <span class="function"><span class="keyword">def</span> <span class="title">do_something</span><span class="params">(params = &#123;&#125;)</span></span></div><div class="line">    unless params[<span class="symbol">:when</span>] == <span class="symbol">:later</span></div><div class="line">      output(options[<span class="symbol">:message</span>])</div><div class="line">    <span class="keyword">end</span></div><div class="line">  <span class="keyword">end</span></div><div class="line"><span class="keyword">end</span></div></pre></td></tr></table></figure>
</li>
<li><p><a name="safe-assignment-in-condition"></a><br>不要在条件表达式中使用 <code>=</code>（赋值语句）的返回值，除非赋值语句包裹在括号之中。这种惯用法被称作<strong>条件表达式中的安全赋值</strong>。<br><sup>[<a href="#safe-assignment-in-condition">link</a>]</sup></p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 差 - 会出现警告</span></div><div class="line"><span class="keyword">if</span> v = array.grep(<span class="regexp">/foo/</span>)</div><div class="line">  do_something(v)</div><div class="line">  ...</div><div class="line"><span class="keyword">end</span></div><div class="line"></div><div class="line"><span class="comment"># 好 - 尽管 Ruby 解释器仍会出现警告，但 RuboCop 不会</span></div><div class="line"><span class="keyword">if</span> (v = array.grep(<span class="regexp">/foo/</span>))</div><div class="line">  do_something(v)</div><div class="line">  ...</div><div class="line"><span class="keyword">end</span></div><div class="line"></div><div class="line"><span class="comment"># 好</span></div><div class="line">v = array.grep(<span class="regexp">/foo/</span>)</div><div class="line"><span class="keyword">if</span> v</div><div class="line">  do_something(v)</div><div class="line">  ...</div><div class="line"><span class="keyword">end</span></div></pre></td></tr></table></figure>
</li>
<li><p><a name="self-assignment"></a><br>优先考虑简短的自我赋值语法。<br><sup>[<a href="#self-assignment">link</a>]</sup></p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 差</span></div><div class="line">x = x + y</div><div class="line">x = x * y</div><div class="line">x = x**y</div><div class="line">x = x / y</div><div class="line">x = x <span class="params">||</span> y</div><div class="line">x = x &amp;&amp; y</div><div class="line"></div><div class="line"><span class="comment"># 好</span></div><div class="line">x += y</div><div class="line">x *= y</div><div class="line">x **= y</div><div class="line">x /= y</div><div class="line">x <span class="params">||</span>= y</div><div class="line">x &amp;&amp;= y</div></pre></td></tr></table></figure>
</li>
<li><p><a name="double-pipe-for-uninit"></a><br>当变量尚未初始化时，使用 <code>||=</code> 对其进行初始化。<br><sup>[<a href="#double-pipe-for-uninit">link</a>]</sup></p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 差</span></div><div class="line">name = name ? name : <span class="string">'Bozhidar'</span></div><div class="line"></div><div class="line"><span class="comment"># 差</span></div><div class="line">name = <span class="string">'Bozhidar'</span> unless name</div><div class="line"></div><div class="line"><span class="comment"># 好 - 当且仅当 name 为 nil 或 false 时，设置 name 的值为 'Bozhidar'</span></div><div class="line">name <span class="params">||</span>= <span class="string">'Bozhidar'</span></div></pre></td></tr></table></figure>
</li>
<li><p><a name="no-double-pipes-for-bools"></a><br>不要使用 <code>||=</code> 对布尔变量进行初始化。<br><sup>[<a href="#no-double-pipes-for-bools">link</a>]</sup></p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 差 - 设置 enabled 的值为 true，即使其原本的值是 false</span></div><div class="line">enabled <span class="params">||</span>= <span class="literal">true</span></div><div class="line"></div><div class="line"><span class="comment"># 好</span></div><div class="line">enabled = <span class="literal">true</span> <span class="keyword">if</span> enabled.<span class="literal">nil</span>?</div></pre></td></tr></table></figure>
</li>
<li><p><a name="double-amper-preprocess"></a><br>使用 <code>&amp;&amp;=</code> 预先检查变量是否存在，如果存在，则做相应动作。使用 <code>&amp;&amp;=</code> 语法可以省去 <code>if</code> 检查。<br><sup>[<a href="#double-amper-preprocess">link</a>]</sup></p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 差</span></div><div class="line"><span class="keyword">if</span> something</div><div class="line">  something = something.downcase</div><div class="line"><span class="keyword">end</span></div><div class="line"></div><div class="line"><span class="comment"># 差</span></div><div class="line">something = something ? something.downcase : <span class="literal">nil</span></div><div class="line"></div><div class="line"><span class="comment"># 勉强可以</span></div><div class="line">something = something.downcase <span class="keyword">if</span> something</div><div class="line"></div><div class="line"><span class="comment"># 好</span></div><div class="line">something = something &amp;&amp; something.downcase</div><div class="line"></div><div class="line"><span class="comment"># 更好</span></div><div class="line">something &amp;&amp;= something.downcase</div></pre></td></tr></table></figure>
</li>
<li><p><a name="no-case-equality"></a><br>避免使用 <code>case</code> 语句等价操作符 <code>===</code>。从名称可知，这是 <code>case</code> 语句隐式使用的操作符，在 <code>case</code> 语句外的场合中使用，会产生难以理解的代码。<br><sup>[<a href="#no-case-equality">link</a>]</sup></p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 差</span></div><div class="line">Array === something</div><div class="line">(<span class="number">1</span>..<span class="number">100</span>) === <span class="number">7</span></div><div class="line">/something/ === some_string</div><div class="line"></div><div class="line"><span class="comment"># 好</span></div><div class="line">something.is_a?(Array)</div><div class="line">(<span class="number">1</span>..<span class="number">100</span>).<span class="keyword">include</span>?(<span class="number">7</span>)</div><div class="line">some_string =~ <span class="regexp">/something/</span></div></pre></td></tr></table></figure>
</li>
<li><p><a name="eql"></a><br>能使用 <code>==</code> 就不要使用 <code>eql?</code>。提供更加严格比较的 <code>eql?</code> 在实践中极少使用。<br><sup>[<a href="#eql">link</a>]</sup></p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 差 - 对于字符串，eql? 与 == 具有相同效果</span></div><div class="line"><span class="string">'ruby'</span>.eql? some_str</div><div class="line"></div><div class="line"><span class="comment"># 好</span></div><div class="line"><span class="string">'ruby'</span> == some_str</div><div class="line"><span class="number">1.0</span>.eql? x <span class="comment"># 当需要区别 Fixnum 1 与 Float 1.0 时，eql? 是具有意义的</span></div></pre></td></tr></table></figure>
</li>
<li><p><a name="no-cryptic-perlisms"></a><br>避免使用 Perl 风格的特殊变量（比如 <code>$:</code>、<code>$;</code> 等）。它们看起来非常神秘，但除了单行脚本，其他情况并不鼓励使用。建议使用 <code>English</code> 程序库提供的友好别名。<br><sup>[<a href="#no-cryptic-perlisms">link</a>]</sup></p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 差</span></div><div class="line">$:.unshift File.dirname(__FILE_<span class="number">_</span>)</div><div class="line"></div><div class="line"><span class="comment"># 好</span></div><div class="line"><span class="keyword">require</span> <span class="string">'English'</span></div><div class="line">$LOAD_PATH.unshift File.dirname(__FILE_<span class="number">_</span>)</div></pre></td></tr></table></figure>
</li>
<li><p><a name="parens-no-spaces"></a><br>永远不要在方法名与左括号之间添加空格。<br><sup>[<a href="#parens-no-spaces">link</a>]</sup></p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 差</span></div><div class="line">f (<span class="number">3</span> + <span class="number">2</span>) + <span class="number">1</span></div><div class="line"></div><div class="line"><span class="comment"># 好</span></div><div class="line">f(<span class="number">3</span> + <span class="number">2</span>) + <span class="number">1</span></div></pre></td></tr></table></figure>
</li>
<li><p><a name="parens-as-args"></a><br>如果方法调用的第一个参数以左括号开头，则此方法调用应该使用括号，比如 <code>f((3 + 2) + 1)</code>。<br><sup>[<a href="#parens-as-args">link</a>]</sup></p>
</li>
<li><p><a name="always-warn-at-runtime"></a><br>运行 Ruby 解释器时，总是开启 <code>-w</code> 选项来。如果你忘了某个上述某个规则，它就会警告你！<br><sup>[<a href="#always-warn-at-runtime">link</a>]</sup></p>
</li>
<li><p><a name="no-nested-methods"></a><br>不要在方法中嵌套定义方法，使用 lambda 方法来替代。 嵌套定义产生的方法，事实上和外围方法处于同一作用域（比如类作用域）。此外，“嵌套方法”会在定义它的外围方法每次调用时被重新定义。<br><sup>[<a href="#no-nested-methods">link</a>]</sup></p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 差</span></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">foo</span><span class="params">(x)</span></span></div><div class="line">  <span class="function"><span class="keyword">def</span> <span class="title">bar</span><span class="params">(y)</span></span></div><div class="line">    <span class="comment"># 省略主体</span></div><div class="line">  <span class="keyword">end</span></div><div class="line"></div><div class="line">  bar(x)</div><div class="line"><span class="keyword">end</span></div><div class="line"></div><div class="line"><span class="comment"># 好 - 作用同前，但 bar 不会在 foo 每次调用时被重新定义</span></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">bar</span><span class="params">(y)</span></span></div><div class="line">  <span class="comment"># 省略主体</span></div><div class="line"><span class="keyword">end</span></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">foo</span><span class="params">(x)</span></span></div><div class="line">  bar(x)</div><div class="line"><span class="keyword">end</span></div><div class="line"></div><div class="line"><span class="comment"># 好</span></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">foo</span><span class="params">(x)</span></span></div><div class="line">  bar = -&gt;(y) &#123; ... &#125;</div><div class="line">  bar.call(x)</div><div class="line"><span class="keyword">end</span></div></pre></td></tr></table></figure>
</li>
<li><p><a name="lambda-multi-line"></a><br>对于单行区块，使用新的 lambda 字面量定义语法。对于多行区块，使用 <code>lambda</code> 定义语法。<br><sup>[<a href="#lambda-multi-line">link</a>]</sup></p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 差</span></div><div class="line">l = lambda &#123; <span class="params">|a, b|</span> a + b &#125;</div><div class="line">l.call(<span class="number">1</span>, <span class="number">2</span>)</div><div class="line"></div><div class="line"><span class="comment"># 好 - 但看起来怪怪的</span></div><div class="line">l = -&gt;(a, b) <span class="keyword">do</span></div><div class="line">  tmp = a * <span class="number">7</span></div><div class="line">  tmp * b / <span class="number">50</span></div><div class="line"><span class="keyword">end</span></div><div class="line"></div><div class="line"><span class="comment"># 好</span></div><div class="line">l = -&gt;(a, b) &#123; a + b &#125;</div><div class="line">l.call(<span class="number">1</span>, <span class="number">2</span>)</div><div class="line"></div><div class="line">l = lambda <span class="keyword">do</span> <span class="params">|a, b|</span></div><div class="line">  tmp = a * <span class="number">7</span></div><div class="line">  tmp * b / <span class="number">50</span></div><div class="line"><span class="keyword">end</span></div></pre></td></tr></table></figure>
</li>
<li><p><a name="stabby-lambda-with-args"></a><br>定义 lambda 方法时，如果有参数则使用括号。<br><sup>[<a href="#stabby-lambda-with-args">link</a>]</sup></p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 差</span></div><div class="line">l = -&gt;x, y &#123; something(x, y) &#125;</div><div class="line"></div><div class="line"><span class="comment"># 好</span></div><div class="line">l = -&gt;(x, y) &#123; something(x, y) &#125;</div></pre></td></tr></table></figure>
</li>
<li><p><a name="stabby-lambda-no-args"></a><br>定义 lambda 方法时，如果无参数则省略括号。<br><sup>[<a href="#stabby-lambda-no-args">link</a>]</sup></p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 差</span></div><div class="line">l = -&gt;() &#123; something &#125;</div><div class="line"></div><div class="line"><span class="comment"># 好</span></div><div class="line">l = -&gt; &#123; something &#125;</div></pre></td></tr></table></figure>
</li>
<li><p><a name="proc"></a><br>倾向使用 <code>proc</code> 而不是 <code>Proc.new</code>。<br><sup>[<a href="#proc">link</a>]</sup></p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 差</span></div><div class="line">p = Proc.new &#123; <span class="params">|n|</span> puts n &#125;</div><div class="line"></div><div class="line"><span class="comment"># 好</span></div><div class="line">p = proc &#123; <span class="params">|n|</span> puts n &#125;</div></pre></td></tr></table></figure>
</li>
<li><p><a name="proc-call"></a><br>对于 lambda 方法或代码块，倾向使用 <code>proc.call()</code> 而不是 <code>proc[]</code> 或 <code>proc.()</code>。<br><sup>[<a href="#proc-call">link</a>]</sup></p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 差 - 看上去像是枚举器的存取操作</span></div><div class="line">l = -&gt;(v) &#123; puts v &#125;</div><div class="line">l[<span class="number">1</span>]</div><div class="line"></div><div class="line"><span class="comment"># 差 - 极少见的调用语法</span></div><div class="line">l = -&gt;(v) &#123; puts v &#125;</div><div class="line">l.(<span class="number">1</span>)</div><div class="line"></div><div class="line"><span class="comment"># 好</span></div><div class="line">l = -&gt;(v) &#123; puts v &#125;</div><div class="line">l.call(<span class="number">1</span>)</div></pre></td></tr></table></figure>
</li>
<li><p><a name="underscore-unused-vars"></a><br>未被使用的区块参数或局部变量，添加 <code>_</code> 前缀或直接使用 <code>_</code>（尽管表意性略差）。这种做法可以抑制 Ruby 解释器或 RuboCop 等工具发出“变量尚未使用”的警告。<br><sup>[<a href="#underscore-unused-vars">link</a>]</sup></p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 差</span></div><div class="line">result = hash.map &#123; <span class="params">|k, v|</span> v + <span class="number">1</span> &#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">something</span><span class="params">(x)</span></span></div><div class="line">  unused_var, used_var = something_else(x)</div><div class="line">  <span class="comment"># ...</span></div><div class="line"><span class="keyword">end</span></div><div class="line"></div><div class="line"><span class="comment"># 好</span></div><div class="line">result = hash.map &#123; <span class="params">|_k, v|</span> v + <span class="number">1</span> &#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">something</span><span class="params">(x)</span></span></div><div class="line">  _unused_var, used_var = something_else(x)</div><div class="line">  <span class="comment"># ...</span></div><div class="line"><span class="keyword">end</span></div><div class="line"></div><div class="line"><span class="comment"># 好</span></div><div class="line">result = hash.map &#123; <span class="params">|_, v|</span> v + <span class="number">1</span> &#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">something</span><span class="params">(x)</span></span></div><div class="line">  <span class="number">_</span>, used_var = something_else(x)</div><div class="line">  <span class="comment"># ...</span></div><div class="line"><span class="keyword">end</span></div></pre></td></tr></table></figure>
</li>
<li><p><a name="global-stdout"></a><br>使用 <code>$stdout/$stderr/$stdin</code> 而不是 <code>STDOUT/STDERR/STDIN</code>。<code>STDOUT/STDERR/STDIN</code> 是常量，尽管在 Ruby 中允许给常量重新赋值（可能是重定向某些流），但解释器会发出警告。<br><sup>[<a href="#global-stdout">link</a>]</sup></p>
</li>
<li><p><a name="warn"></a><br>使用 <code>warn</code> 而不是 <code>$stderr.puts</code>。除了更加简练清晰外，<code>warn</code> 允许你在需要时通过设置解释器选项（使用 <code>-W0</code> 将警告级别设置为 0）来抑制警告。<br><sup>[<a href="#warn">link</a>]</sup></p>
</li>
<li><p><a name="sprintf"></a><br>倾向使用 <code>sprintf</code> 或其别名 <code>format</code> 而不是相当晦涩的 <code>String#%</code> 方法。<br><sup>[<a href="#sprintf">link</a>]</sup></p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 差</span></div><div class="line"><span class="string">'%d %d'</span> % [<span class="number">20</span>, <span class="number">10</span>]</div><div class="line"><span class="comment"># =&gt; '20 10'</span></div><div class="line"></div><div class="line"><span class="comment"># 好</span></div><div class="line">sprintf(<span class="string">'%d %d'</span>, <span class="number">20</span>, <span class="number">10</span>)</div><div class="line"><span class="comment"># =&gt; '20 10'</span></div><div class="line"></div><div class="line"><span class="comment"># 好</span></div><div class="line">sprintf(<span class="string">'%&#123;first&#125; %&#123;second&#125;'</span>, <span class="symbol">first:</span> <span class="number">20</span>, <span class="symbol">second:</span> <span class="number">10</span>)</div><div class="line"><span class="comment"># =&gt; '20 10'</span></div><div class="line"></div><div class="line">format(<span class="string">'%d %d'</span>, <span class="number">20</span>, <span class="number">10</span>)</div><div class="line"><span class="comment"># =&gt; '20 10'</span></div><div class="line"></div><div class="line"><span class="comment"># 好</span></div><div class="line">format(<span class="string">'%&#123;first&#125; %&#123;second&#125;'</span>, <span class="symbol">first:</span> <span class="number">20</span>, <span class="symbol">second:</span> <span class="number">10</span>)</div><div class="line"><span class="comment"># =&gt; '20 10'</span></div></pre></td></tr></table></figure>
</li>
<li><p><a name="array-join"></a><br>倾向使用 <code>Array#join</code> 而不是相当晦涩的带字符参数的 <code>Array#*</code> 方法。<br><sup>[<a href="#array-join">link</a>]</sup></p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 差</span></div><div class="line"><span class="string">%w(one two three)</span> * <span class="string">', '</span></div><div class="line"><span class="comment"># =&gt; 'one, two, three'</span></div><div class="line"></div><div class="line"><span class="comment"># 好</span></div><div class="line"><span class="string">%w(one two three)</span>.join(<span class="string">', '</span>)</div><div class="line"><span class="comment"># =&gt; 'one, two, three'</span></div></pre></td></tr></table></figure>
</li>
<li><p><a name="array-coercion"></a><br>当你希望处理的变量类型是数组，但不太确定其是否真的是数组时，通过使用 <code>Array()</code> 来替代显式的数组类型检查与转换。<br><sup>[<a href="#array-coercion">link</a>]</sup></p>
</li>
</ul>
  <figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 差</span></div><div class="line">paths = [paths] unless paths.is_a? Array</div><div class="line">paths.each &#123; <span class="params">|path|</span> do_something(path) &#125;</div><div class="line"></div><div class="line"><span class="comment"># 差 - 总是构建新的数组对象</span></div><div class="line">[*paths].each &#123; <span class="params">|path|</span> do_something(path) &#125;</div><div class="line"></div><div class="line"><span class="comment"># 好</span></div><div class="line">Array(paths).each &#123; <span class="params">|path|</span> do_something(path) &#125;</div></pre></td></tr></table></figure>
<ul>
<li><p><a name="ranges-or-between"></a><br>通过使用范围或 <code>Comparable#between?</code> 来替代复杂的比较逻辑。<br><sup>[<a href="#ranges-or-between">link</a>]</sup></p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 差</span></div><div class="line">do_something <span class="keyword">if</span> x &gt;= <span class="number">1000</span> &amp;&amp; x &lt;= <span class="number">2000</span></div><div class="line"></div><div class="line"><span class="comment"># 好</span></div><div class="line">do_something <span class="keyword">if</span> (<span class="number">1000</span>..<span class="number">2000</span>).<span class="keyword">include</span>?(x)</div><div class="line"></div><div class="line"><span class="comment"># 好</span></div><div class="line">do_something <span class="keyword">if</span> x.between?(<span class="number">1000</span>, <span class="number">2000</span>)</div></pre></td></tr></table></figure>
</li>
<li><p><a name="predicate-methods"></a><br>倾向使用谓词方法而不是 <code>==</code> 操作符。但数值比较除外。<br><sup>[<a href="#predicate-methods">link</a>]</sup></p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 差</span></div><div class="line"><span class="keyword">if</span> x % <span class="number">2</span> == <span class="number">0</span></div><div class="line"><span class="keyword">end</span></div><div class="line"></div><div class="line"><span class="keyword">if</span> x % <span class="number">2</span> == <span class="number">1</span></div><div class="line"><span class="keyword">end</span></div><div class="line"></div><div class="line"><span class="keyword">if</span> x == <span class="literal">nil</span></div><div class="line"><span class="keyword">end</span></div><div class="line"></div><div class="line"><span class="comment"># 好</span></div><div class="line"><span class="keyword">if</span> x.even?</div><div class="line"><span class="keyword">end</span></div><div class="line"></div><div class="line"><span class="keyword">if</span> x.odd?</div><div class="line"><span class="keyword">end</span></div><div class="line"></div><div class="line"><span class="keyword">if</span> x.<span class="literal">nil</span>?</div><div class="line"><span class="keyword">end</span></div><div class="line"></div><div class="line"><span class="keyword">if</span> x.zero?</div><div class="line"><span class="keyword">end</span></div><div class="line"></div><div class="line"><span class="keyword">if</span> x == <span class="number">0</span></div><div class="line"><span class="keyword">end</span></div></pre></td></tr></table></figure>
</li>
<li><p><a name="no-non-nil-checks"></a><br>不做显式的 <code>non-nil</code> 检查，除非检查对象是布尔变量。<br><sup>[<a href="#no-non-nil-checks">link</a>]</sup></p>
  <figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 差</span></div><div class="line">do_something <span class="keyword">if</span> !something.<span class="literal">nil</span>?</div><div class="line">do_something <span class="keyword">if</span> something != <span class="literal">nil</span></div><div class="line"></div><div class="line"><span class="comment"># 好</span></div><div class="line">do_something <span class="keyword">if</span> something</div><div class="line"></div><div class="line"><span class="comment"># 好 - 检查对象是布尔变量</span></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">value_set?</span></span></div><div class="line">  !@some_boolean.<span class="literal">nil</span>?</div><div class="line"><span class="keyword">end</span></div></pre></td></tr></table></figure>
</li>
<li><p><a name="no-BEGIN-blocks"></a><br>避免使用 <code>BEGIN</code> 区块。<br><sup>[<a href="#no-BEGIN-blocks">link</a>]</sup></p>
</li>
<li><p><a name="no-END-blocks"></a><br>永远不要使用 <code>END</code> 区块。使用 <code>Kernel#at_exit</code> 来替代。<br><sup>[<a href="#no-END-blocks">link</a>]</sup></p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 差</span></div><div class="line"><span class="keyword">END</span> &#123; puts <span class="string">'Goodbye!'</span> &#125;</div><div class="line"></div><div class="line"><span class="comment"># 好</span></div><div class="line">at_exit &#123; puts <span class="string">'Goodbye!'</span> &#125;</div></pre></td></tr></table></figure>
</li>
<li><p><a name="no-flip-flops"></a><br>避免使用 flip-flops 操作符。<br><sup>[<a href="#no-flip-flops">link</a>]</sup></p>
</li>
<li><p><a name="no-nested-conditionals"></a><br>流程控制中，避免使用嵌套条件。<br><sup>[<a href="#no-nested-conditionals">link</a>]</sup></p>
<p>倾向使用防御从句进行非法数据断言。防御从句是指处于方法顶部的条件语句，其能尽早地退出方法。</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 差</span></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">compute_thing</span><span class="params">(thing)</span></span></div><div class="line">  <span class="keyword">if</span> thing[<span class="symbol">:foo</span>]</div><div class="line">    update_with_bar(thing)</div><div class="line">    <span class="keyword">if</span> thing[<span class="symbol">:foo</span>][<span class="symbol">:bar</span>]</div><div class="line">      partial_compute(thing)</div><div class="line">    <span class="keyword">else</span></div><div class="line">      re_compute(thing)</div><div class="line">    <span class="keyword">end</span></div><div class="line">  <span class="keyword">end</span></div><div class="line"><span class="keyword">end</span></div><div class="line"></div><div class="line"><span class="comment"># 好</span></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">compute_thing</span><span class="params">(thing)</span></span></div><div class="line">  <span class="keyword">return</span> unless thing[<span class="symbol">:foo</span>]</div><div class="line">  update_with_bar(thing[<span class="symbol">:foo</span>])</div><div class="line">  <span class="keyword">return</span> re_compute(thing) unless thing[<span class="symbol">:foo</span>][<span class="symbol">:bar</span>]</div><div class="line">  partial_compute(thing)</div><div class="line"><span class="keyword">end</span></div></pre></td></tr></table></figure>
<p>循环中，倾向使用 <code>next</code> 而不是条件区块。</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 差</span></div><div class="line">[<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>].each <span class="keyword">do</span> <span class="params">|item|</span></div><div class="line">  <span class="keyword">if</span> item &gt; <span class="number">1</span></div><div class="line">    puts item</div><div class="line">  <span class="keyword">end</span></div><div class="line"><span class="keyword">end</span></div><div class="line"></div><div class="line"><span class="comment"># 好</span></div><div class="line">[<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>].each <span class="keyword">do</span> <span class="params">|item|</span></div><div class="line">  <span class="keyword">next</span> unless item &gt; <span class="number">1</span></div><div class="line">  puts item</div><div class="line"><span class="keyword">end</span></div></pre></td></tr></table></figure>
</li>
<li><p><a name="map-find-select-reduce-size"></a><br>倾向使用 <code>map</code> 而不是 <code>collect</code>，<code>find</code> 而不是 <code>detect</code>，<code>select</code> 而不是 <code>find_all</code>，<code>reduce</code> 而不是 <code>inject</code> 以及 <code>size</code> 而不是 <code>length</code>。这不是一个硬性要求，如果使用别名可以增强可读性，使用它也没关系。这些别名方法继承自 Smalltalk 语言，但在别的语言并不通用。鼓励使用 <code>select</code> 而不是 <code>find_all</code> 的理由是前者与 <code>reject</code> 搭配起来一目了然。<br><sup>[<a href="#map-find-select-reduce-size">link</a>]</sup></p>
</li>
<li><p><a name="count-vs-size"></a><br>不要使用 <code>count</code> 作为 <code>size</code> 的替代方案。除了 <code>Array</code> 外，其他 <code>Enumerable</code> 对象都需要通过枚举整个集合才可以确定数目。<br><sup>[<a href="#count-vs-size">link</a>]</sup></p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 差</span></div><div class="line">some_hash.count</div><div class="line"></div><div class="line"><span class="comment"># 好</span></div><div class="line">some_hash.size</div></pre></td></tr></table></figure>
</li>
<li><p><a name="flat-map"></a><br>倾向使用 <code>flat_map</code> 而不是 <code>map + flatten</code> 的组合。此规则并不适用于深度超过 2 层的数组。举例来说，如果 <code>users.first.songs == [&#39;a&#39;, [&#39;b&#39;,&#39;c&#39;]]</code> 成立，则使用 <code>map + flatten</code> 的组合而不是 <code>flat_map</code>。<code>flat_map</code> 只能平坦化一个层级，而 <code>flatten</code> 能够平坦化任意多个层级。<br><sup>[<a href="#flat-map">link</a>]</sup></p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 差</span></div><div class="line">all_songs = users.map(&amp;<span class="symbol">:songs</span>).flatten.uniq</div><div class="line"></div><div class="line"><span class="comment"># 好</span></div><div class="line">all_songs = users.flat_map(&amp;<span class="symbol">:songs</span>).uniq</div></pre></td></tr></table></figure>
</li>
<li><p><a name="reverse-each"></a><br>倾向使用 <code>reverse_each</code> 而不是 <code>reverse.each</code>，因为某些混入 <code>Enumerable</code> 模块的类可能会提供 <code>reverse_each</code> 的高效版本。即使这些类没有提供专门特化的版本，继承自 <code>Enumerable</code> 的通用版本至少能保证性能与 <code>reverse.each</code> 相当。<br><sup>[<a href="#reverse-each">link</a>]</sup></p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 差</span></div><div class="line">array.reverse.each &#123; ... &#125;</div><div class="line"></div><div class="line"><span class="comment"># 好</span></div><div class="line">array.reverse_each &#123; ... &#125;</div></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="命名"><a href="#命名" class="headerlink" title="命名"></a>命名</h2><blockquote>
<p>程序设计的真正难题是替事物命名及使缓存失效。<br><br>——Phil Karlton</p>
</blockquote>
<ul>
<li><p><a name="english-identifiers"></a><br>标识符使用英文命名。<br><sup>[<a href="#english-identifiers">link</a>]</sup></p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 差 - 标识符使用非 ASCII 字符</span></div><div class="line">заплата = <span class="number">1_000</span></div><div class="line"></div><div class="line"><span class="comment"># 差 - 标识符使用拉丁文写法的保加利亚单词</span></div><div class="line">zaplata = <span class="number">1_000</span></div><div class="line"></div><div class="line"><span class="comment"># 好</span></div><div class="line">salary = <span class="number">1_000</span></div></pre></td></tr></table></figure>
</li>
<li><p><a name="snake-case-symbols-methods-vars"></a><br>符号、方法、变量使用蛇底式小写（<code>snake_case</code>）。<br><sup>[<a href="#snake-case-symbols-methods-vars">link</a>]</sup></p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 差</span></div><div class="line"><span class="symbol">:<span class="string">'some symbol'</span></span></div><div class="line"><span class="symbol">:SomeSymbol</span></div><div class="line"><span class="symbol">:someSymbol</span></div><div class="line"></div><div class="line">someVar = <span class="number">5</span></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">someMethod</span></span></div><div class="line">  ...</div><div class="line"><span class="keyword">end</span></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">SomeMethod</span></span></div><div class="line"> ...</div><div class="line"><span class="keyword">end</span></div><div class="line"></div><div class="line"><span class="comment"># 好</span></div><div class="line"><span class="symbol">:some_symbol</span></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">some_method</span></span></div><div class="line">  ...</div><div class="line"><span class="keyword">end</span></div></pre></td></tr></table></figure>
</li>
<li><p><a name="camelcase-classes"></a><br>类与模块使用驼峰式大小写（<code>CamelCase</code>）。（HTTP、RFC、XML 等首字母缩写应该仍旧保持大写形式）<br><sup>[<a href="#camelcase-classes">link</a>]</sup></p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 差</span></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Someclass</span></span></div><div class="line">  ...</div><div class="line"><span class="keyword">end</span></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Some_Class</span></span></div><div class="line">  ...</div><div class="line"><span class="keyword">end</span></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">SomeXml</span></span></div><div class="line">  ...</div><div class="line"><span class="keyword">end</span></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">XmlSomething</span></span></div><div class="line">  ...</div><div class="line"><span class="keyword">end</span></div><div class="line"></div><div class="line"><span class="comment"># 好</span></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">SomeClass</span></span></div><div class="line">  ...</div><div class="line"><span class="keyword">end</span></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">SomeXML</span></span></div><div class="line">  ...</div><div class="line"><span class="keyword">end</span></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">XMLSomething</span></span></div><div class="line">  ...</div><div class="line"><span class="keyword">end</span></div></pre></td></tr></table></figure>
</li>
<li><p><a name="snake-case-files"></a><br>文件名使用蛇底式小写，如 <code>hello_world.rb</code>。<br><sup>[<a href="#snake-case-files">link</a>]</sup></p>
</li>
<li><p><a name="snake-case-dirs"></a><br>目录名使用蛇底式小写，如 <code>lib/hello_world/hello_world.rb</code>。<br><sup>[<a href="#snake-case-dirs">link</a>]</sup></p>
</li>
<li><p><a name="one-class-per-file"></a><br>尽量使一个源文件中只有一个类或模块。文件名就是类名或模块名，但使用蛇底式小写而不是驼峰式大小写。<br><sup>[<a href="#one-class-per-file">link</a>]</sup></p>
</li>
<li><p><a name="screaming-snake-case"></a><br>其他常量使用尖叫蛇底式大写（SCREAMING_SNAKE_CASE）。<br><sup>[<a href="#screaming-snake-case">link</a>]</sup></p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 差</span></div><div class="line">SomeConst = <span class="number">5</span></div><div class="line"></div><div class="line"><span class="comment"># 好</span></div><div class="line">SOME_CONST = <span class="number">5</span></div></pre></td></tr></table></figure>
</li>
<li><p><a name="bool-methods-qmark"></a><br>谓词方法（返回布尔值的方法）的名字应当以问号结尾。（比如 <code>Array#empty?</code>）。不返回布尔值的方法不应以问号结尾。<br><sup>[<a href="#bool-methods-qmark">link</a>]</sup></p>
</li>
<li><p><a name="bool-methods-prefix"></a><br>谓词方法的名字应当避免使用 <code>is</code>、<code>does</code>、<code>can</code> 等助动词作为前缀。这些助动词在实际场景中显得冗余，且与标准库的命名习惯（比如 <code>empty?</code>、<code>include?</code>）很不一致。<br><sup>[<a href="#bool-methods-prefix">link</a>]</sup></p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 差</span></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span></span></div><div class="line">  <span class="function"><span class="keyword">def</span> <span class="title">is_tall?</span></span></div><div class="line">    <span class="literal">true</span></div><div class="line">  <span class="keyword">end</span></div><div class="line"></div><div class="line">  <span class="function"><span class="keyword">def</span> <span class="title">can_play_basketball?</span></span></div><div class="line">    <span class="literal">false</span></div><div class="line">  <span class="keyword">end</span></div><div class="line"></div><div class="line">  <span class="function"><span class="keyword">def</span> <span class="title">does_like_candy?</span></span></div><div class="line">    <span class="literal">true</span></div><div class="line">  <span class="keyword">end</span></div><div class="line"><span class="keyword">end</span></div><div class="line"></div><div class="line"><span class="comment"># 好</span></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span></span></div><div class="line">  <span class="function"><span class="keyword">def</span> <span class="title">tall?</span></span></div><div class="line">    <span class="literal">true</span></div><div class="line">  <span class="keyword">end</span></div><div class="line"></div><div class="line">  <span class="function"><span class="keyword">def</span> <span class="title">basketball_player?</span></span></div><div class="line">    <span class="literal">false</span></div><div class="line">  <span class="keyword">end</span></div><div class="line"></div><div class="line">  <span class="function"><span class="keyword">def</span> <span class="title">likes_candy?</span></span></div><div class="line">    <span class="literal">true</span></div><div class="line">  <span class="keyword">end</span></div><div class="line"><span class="keyword">end</span></div></pre></td></tr></table></figure>
</li>
<li><p><a name="dangerous-method-bang"></a><br>具有潜在<strong>危险性</strong>的方法，当其存在对应安全版本的方法时，其名字应当以惊叹号结尾。（比如修改 <code>self</code> 或参数值的方法、相对 <code>exit</code> 方法不会在退出时运行 finalizers 执行清理工作的 <code>exit!</code> 方法等）<br><sup>[<a href="#dangerous-method-bang">link</a>]</sup></p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 差 - 没有对应安全版本的方法</span></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span></span></div><div class="line">  <span class="function"><span class="keyword">def</span> <span class="title">update!</span></span></div><div class="line">  <span class="keyword">end</span></div><div class="line"><span class="keyword">end</span></div><div class="line"></div><div class="line"><span class="comment"># 好</span></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span></span></div><div class="line">  <span class="function"><span class="keyword">def</span> <span class="title">update</span></span></div><div class="line">  <span class="keyword">end</span></div><div class="line"><span class="keyword">end</span></div><div class="line"></div><div class="line"><span class="comment"># 好</span></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span></span></div><div class="line">  <span class="function"><span class="keyword">def</span> <span class="title">update!</span></span></div><div class="line">  <span class="keyword">end</span></div><div class="line"></div><div class="line">  <span class="function"><span class="keyword">def</span> <span class="title">update</span></span></div><div class="line">  <span class="keyword">end</span></div><div class="line"><span class="keyword">end</span></div></pre></td></tr></table></figure>
</li>
<li><p><a name="safe-because-unsafe"></a><br>尽量根据危险方法来定义对应安全版本的方法。<br><sup>[<a href="#safe-because-unsafe">link</a>]</sup></p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Array</span></span></div><div class="line">  <span class="function"><span class="keyword">def</span> <span class="title">flatten_once!</span></span></div><div class="line">    res = []</div><div class="line"></div><div class="line">    each <span class="keyword">do</span> <span class="params">|e|</span></div><div class="line">      [*e].each &#123; <span class="params">|f|</span> res &lt;&lt; f &#125;</div><div class="line">    <span class="keyword">end</span></div><div class="line"></div><div class="line">    replace(res)</div><div class="line">  <span class="keyword">end</span></div><div class="line"></div><div class="line">  <span class="function"><span class="keyword">def</span> <span class="title">flatten_once</span></span></div><div class="line">    dup.flatten_once!</div><div class="line">  <span class="keyword">end</span></div><div class="line"><span class="keyword">end</span></div></pre></td></tr></table></figure>
</li>
<li><p><a name="reduce-blocks"></a><br>当配合单行区块使用 <code>reduce</code> 时，将参数命名为 <code>|a, e|</code>（accumulator/累加器，element/元素）。<br><sup>[<a href="#reduce-blocks">link</a>]</sup></p>
</li>
<li><p><a name="other-arg"></a><br>当定义二元操作符时，将参数命名为 <code>other</code>（<code>&lt;&lt;</code> 与 <code>[]</code> 例外，因为其语义与此不同）。<br><sup>[<a href="#other-arg">link</a>]</sup></p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">+</span><span class="params">(other)</span></span></div><div class="line">  <span class="comment"># 省略主体</span></div><div class="line"><span class="keyword">end</span></div></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="注释"><a href="#注释" class="headerlink" title="注释"></a>注释</h2><blockquote>
<p>良好的代码自身就是最佳的文档。当你要添加一个注释时，扪心自问，“如何改善代码让它不需要注释？” 改善代码，再写相应文档使之更清楚。<br><br>——Steve McConnell</p>
</blockquote>
<ul>
<li><p><a name="no-comments"></a><br>编写让人一目了然的代码然后忽略这一节的其它部分。我是认真的！<br><sup>[<a href="#no-comments">link</a>]</sup></p>
</li>
<li><p><a name="english-comments"></a><br>使用英文编写注释。<br><sup>[<a href="#english-comments">link</a>]</sup></p>
</li>
<li><p><a name="hash-space"></a><br>前导 <code>#</code> 与注释文本之间应当添加一个空格。<br><sup>[<a href="#hash-space">link</a>]</sup></p>
</li>
<li><p><a name="english-syntax"></a><br>注释超过一个单词时，句首字母应当大写，并在语句停顿或结尾处使用标点符号。句号后添加<a href="http://en.wikipedia.org/wiki/Sentence_spacing" target="_blank" rel="external">一个空格</a>。<br><sup>[<a href="#english-syntax">link</a>]</sup></p>
</li>
<li><p><a name="no-superfluous-comments"></a><br>避免无谓的注释。<br><sup>[<a href="#no-superfluous-comments">link</a>]</sup></p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 差</span></div><div class="line">counter += <span class="number">1</span> <span class="comment"># Increments counter by one.</span></div></pre></td></tr></table></figure>
</li>
<li><p><a name="comment-upkeep"></a><br>及时更新注释。过时的注释比没有注释还要糟糕。<br><sup>[<a href="#comment-upkeep">link</a>]</sup></p>
</li>
</ul>
<blockquote>
<p>好的代码就像是好的笑话 —— 它不需要解释。<br><br>——Russ Olsen</p>
</blockquote>
<ul>
<li><a name="refactor-dont-comment"></a><br>避免替烂代码编写注释。重构它们使其变得一目了然。（要么做，要么不做，不要只是试试看。——Yoda）<br><sup>[<a href="#refactor-dont-comment">link</a>]</sup></li>
</ul>
<h3 id="注解"><a href="#注解" class="headerlink" title="注解"></a>注解</h3><ul>
<li><p><a name="annotate-above"></a><br>注解应该直接写在相关代码之前那行。<br><sup>[<a href="#annotate-above">link</a>]</sup></p>
</li>
<li><p><a name="annotate-keywords"></a><br>注解关键字后面，跟着一个冒号及空格，接着是描述问题的文本。<br><sup>[<a href="#annotate-keywords">link</a>]</sup></p>
</li>
<li><p><a name="indent-annotations"></a><br>如果需要用多行来描述问题，后续行要放在 <code>#</code> 后面并缩排两个空格。<br><sup>[<a href="#indent-annotations">link</a>]</sup></p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">bar</span></span></div><div class="line">  <span class="comment"># <span class="doctag">FIXME:</span> This has crashed occasionally since v3.2.1. It may</span></div><div class="line">  <span class="comment">#   be related to the BarBazUtil upgrade.</span></div><div class="line">  baz(<span class="symbol">:quux</span>)</div><div class="line"><span class="keyword">end</span></div></pre></td></tr></table></figure>
</li>
<li><p><a name="rare-eol-annotations"></a><br>当问题是显而易见时，任何文档都是多余的，注解应当放在有问题的那行末尾且不带任何多余说明。这个用法应该算是例外而不是规则。<br><sup>[<a href="#rare-eol-annotations">link</a>]</sup></p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">bar</span></span></div><div class="line">  sleep <span class="number">100</span> <span class="comment"># OPTIMIZE</span></div><div class="line"><span class="keyword">end</span></div></pre></td></tr></table></figure>
</li>
<li><p><a name="todo"></a><br>使用 <code>TODO</code> 标记应当加入的特征与功能。<br><sup>[<a href="#todo">link</a>]</sup></p>
</li>
<li><p><a name="fixme"></a><br>使用 <code>FIXME</code> 标记需要修复的代码。<br><sup>[<a href="#fixme">link</a>]</sup></p>
</li>
<li><p><a name="optimize"></a><br>使用 <code>OPTIMIZE</code> 标记可能引发性能问题的低效代码。<br><sup>[<a href="#optimize">link</a>]</sup></p>
</li>
<li><p><a name="hack"></a><br>使用 <code>HACK</code> 标记代码异味，即那些应当被重构的可疑编码习惯。<br><sup>[<a href="#hack">link</a>]</sup></p>
</li>
<li><p><a name="review"></a><br>使用 <code>REVIEW</code> 标记需要确认与编码意图是否一致的可疑代码。比如，<code>REVIEW: Are we sure this is how the client does X currently?</code>。<br><sup>[<a href="#review">link</a>]</sup></p>
</li>
<li><p><a name="document-annotations"></a><br>适当情况下，可以自行定制其他注解关键字，但别忘记在项目的 <code>README</code> 或类似文档中予以说明。<br><sup>[<a href="#document-annotations">link</a>]</sup></p>
</li>
</ul>
<h2 id="类与模块"><a href="#类与模块" class="headerlink" title="类与模块"></a>类与模块</h2><ul>
<li><p><a name="consistent-classes"></a><br>在类定义中，使用一致的结构。<br><sup>[<a href="#consistent-classes">link</a>]</sup></p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span></span></div><div class="line">  <span class="comment"># 首先是 extend 与 include</span></div><div class="line">  extend SomeModule</div><div class="line">  <span class="keyword">include</span> AnotherModule</div><div class="line"></div><div class="line">  <span class="comment"># 内部类</span></div><div class="line">  CustomErrorKlass = Class.new(StandardError)</div><div class="line"></div><div class="line">  <span class="comment"># 接着是常量</span></div><div class="line">  SOME_CONSTANT = <span class="number">20</span></div><div class="line"></div><div class="line">  <span class="comment"># 接下来是属性宏</span></div><div class="line">  <span class="keyword">attr_reader</span> <span class="symbol">:name</span></div><div class="line"></div><div class="line">  <span class="comment"># 跟着是其他宏（如果有的话）</span></div><div class="line">  validates <span class="symbol">:name</span></div><div class="line"></div><div class="line">  <span class="comment"># 公开的类方法接在下一行</span></div><div class="line">  <span class="function"><span class="keyword">def</span> <span class="title">self</span>.<span class="title">some_method</span></span></div><div class="line">  <span class="keyword">end</span></div><div class="line"></div><div class="line">  <span class="comment"># 初始化方法在类方法和实例方法之间</span></div><div class="line">  <span class="function"><span class="keyword">def</span> <span class="title">initialize</span></span></div><div class="line">  <span class="keyword">end</span></div><div class="line"></div><div class="line">  <span class="comment"># 跟着是公开的实例方法</span></div><div class="line">  <span class="function"><span class="keyword">def</span> <span class="title">some_method</span></span></div><div class="line">  <span class="keyword">end</span></div><div class="line"></div><div class="line">  <span class="comment"># 受保护及私有的方法等放在接近结尾的地方</span></div><div class="line">  protected</div><div class="line"></div><div class="line">  <span class="function"><span class="keyword">def</span> <span class="title">some_protected_method</span></span></div><div class="line">  <span class="keyword">end</span></div><div class="line"></div><div class="line">  private</div><div class="line"></div><div class="line">  <span class="function"><span class="keyword">def</span> <span class="title">some_private_method</span></span></div><div class="line">  <span class="keyword">end</span></div><div class="line"><span class="keyword">end</span></div></pre></td></tr></table></figure>
</li>
<li><p><a name="file-classes"></a><br>如果嵌套类数目较多，进而导致外围类定义较长，则将它们从外围类中提取出来，分别放置在单独的以嵌套类命名的文件中，并将文件归类至以外围类命名的文件夹下。<br><sup>[<a href="#file-classes">link</a>]</sup></p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 差</span></div><div class="line"></div><div class="line"><span class="comment"># foo.rb</span></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Foo</span></span></div><div class="line">  <span class="class"><span class="keyword">class</span> <span class="title">Bar</span></span></div><div class="line">    <span class="comment"># 定义 30 多个方法</span></div><div class="line">  <span class="keyword">end</span></div><div class="line"></div><div class="line">  <span class="class"><span class="keyword">class</span> <span class="title">Car</span></span></div><div class="line">    <span class="comment"># 定义 20 多个方法</span></div><div class="line">  <span class="keyword">end</span></div><div class="line"></div><div class="line">  <span class="comment"># 定义 30 多个方法</span></div><div class="line"><span class="keyword">end</span></div><div class="line"></div><div class="line"><span class="comment"># 好</span></div><div class="line"></div><div class="line"><span class="comment"># foo.rb</span></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Foo</span></span></div><div class="line">  <span class="comment"># 定义 30 多个方法</span></div><div class="line"><span class="keyword">end</span></div><div class="line"></div><div class="line"><span class="comment"># foo/bar.rb</span></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Foo</span></span></div><div class="line">  <span class="class"><span class="keyword">class</span> <span class="title">Bar</span></span></div><div class="line">    <span class="comment"># 定义 30 多个方法</span></div><div class="line">  <span class="keyword">end</span></div><div class="line"><span class="keyword">end</span></div><div class="line"></div><div class="line"><span class="comment"># foo/car.rb</span></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Foo</span></span></div><div class="line">  <span class="class"><span class="keyword">class</span> <span class="title">Car</span></span></div><div class="line">    <span class="comment"># 定义 20 多个方法</span></div><div class="line">  <span class="keyword">end</span></div><div class="line"><span class="keyword">end</span></div></pre></td></tr></table></figure>
</li>
<li><p><a name="modules-vs-classes"></a><br>定义只有类方法的数据类型时，倾向使用模块而不是类。只有当需要实例化时才使用类。<br><sup>[<a href="#modules-vs-classes">link</a>]</sup></p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 差</span></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">SomeClass</span></span></div><div class="line">  <span class="function"><span class="keyword">def</span> <span class="title">self</span>.<span class="title">some_method</span></span></div><div class="line">    <span class="comment"># 省略主体</span></div><div class="line">  <span class="keyword">end</span></div><div class="line"></div><div class="line">  <span class="function"><span class="keyword">def</span> <span class="title">self</span>.<span class="title">some_other_method</span></span></div><div class="line">    <span class="comment"># 省略主体</span></div><div class="line">  <span class="keyword">end</span></div><div class="line"><span class="keyword">end</span></div><div class="line"></div><div class="line"><span class="comment"># 好</span></div><div class="line"><span class="class"><span class="keyword">module</span> <span class="title">SomeModule</span></span></div><div class="line">  module_function</div><div class="line"></div><div class="line">  <span class="function"><span class="keyword">def</span> <span class="title">some_method</span></span></div><div class="line">    <span class="comment"># 省略主体</span></div><div class="line">  <span class="keyword">end</span></div><div class="line"></div><div class="line">  <span class="function"><span class="keyword">def</span> <span class="title">some_other_method</span></span></div><div class="line">    <span class="comment"># 省略主体</span></div><div class="line">  <span class="keyword">end</span></div><div class="line"><span class="keyword">end</span></div></pre></td></tr></table></figure>
</li>
<li><p><a name="module-function"></a><br>当你想将模块的实例方法变成类方法时，倾向使用 <code>module_function</code> 而不是 <code>extend self</code>。<br><sup>[<a href="#module-function">link</a>]</sup></p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 差</span></div><div class="line"><span class="class"><span class="keyword">module</span> <span class="title">Utilities</span></span></div><div class="line">  extend <span class="keyword">self</span></div><div class="line"></div><div class="line">  <span class="function"><span class="keyword">def</span> <span class="title">parse_something</span><span class="params">(string)</span></span></div><div class="line">    <span class="comment"># 做一些事情</span></div><div class="line">  <span class="keyword">end</span></div><div class="line"></div><div class="line">  <span class="function"><span class="keyword">def</span> <span class="title">other_utility_method</span><span class="params">(number, string)</span></span></div><div class="line">    <span class="comment"># 做一些事情</span></div><div class="line">  <span class="keyword">end</span></div><div class="line"><span class="keyword">end</span></div><div class="line"></div><div class="line"><span class="comment"># 好</span></div><div class="line"><span class="class"><span class="keyword">module</span> <span class="title">Utilities</span></span></div><div class="line">  module_function</div><div class="line"></div><div class="line">  <span class="function"><span class="keyword">def</span> <span class="title">parse_something</span><span class="params">(string)</span></span></div><div class="line">    <span class="comment"># 做一些事情</span></div><div class="line">  <span class="keyword">end</span></div><div class="line"></div><div class="line">  <span class="function"><span class="keyword">def</span> <span class="title">other_utility_method</span><span class="params">(number, string)</span></span></div><div class="line">    <span class="comment"># 做一些事情</span></div><div class="line">  <span class="keyword">end</span></div><div class="line"><span class="keyword">end</span></div></pre></td></tr></table></figure>
</li>
<li><p><a name="liskov"></a><br>当设计类的层次结构时，确保它们符合<a href="http://en.wikipedia.org/wiki/Liskov_substitution_principle" target="_blank" rel="external">里式替换原则</a>。<br><sup>[<a href="#liskov">link</a>]</sup></p>
</li>
<li><p><a name="solid-design"></a><br>让你的类尽量满足 <a href="http://en.wikipedia.org/wiki/SOLID_(object-oriented_design" target="_blank" rel="external">SOLID 原则</a>) 。<br><sup>[<a href="#solid-design">link</a>]</sup></p>
</li>
<li><p><a name="define-to-s"></a><br>总是替那些用以表示领域模型的类提供一个适当的 <code>to_s</code> 方法。<br><sup>[<a href="#define-to-s">link</a>]</sup></p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span></span></div><div class="line">  <span class="keyword">attr_reader</span> <span class="symbol">:first_name</span>, <span class="symbol">:last_name</span></div><div class="line"></div><div class="line">  <span class="function"><span class="keyword">def</span> <span class="title">initialize</span><span class="params">(first_name, last_name)</span></span></div><div class="line">    @first_name = first_name</div><div class="line">    @last_name = last_name</div><div class="line">  <span class="keyword">end</span></div><div class="line"></div><div class="line">  <span class="function"><span class="keyword">def</span> <span class="title">to_s</span></span></div><div class="line">    <span class="string">"<span class="subst">#&#123;@first_name&#125;</span> <span class="subst">#&#123;@last_name&#125;</span>"</span></div><div class="line">  <span class="keyword">end</span></div><div class="line"><span class="keyword">end</span></div></pre></td></tr></table></figure>
</li>
<li><p><a name="attr_family"></a><br>使用 <code>attr</code> 系列方法来定义琐碎的存取器或修改器。<br><sup>[<a href="#attr_family">link</a>]</sup></p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 差</span></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span></span></div><div class="line">  <span class="function"><span class="keyword">def</span> <span class="title">initialize</span><span class="params">(first_name, last_name)</span></span></div><div class="line">    @first_name = first_name</div><div class="line">    @last_name = last_name</div><div class="line">  <span class="keyword">end</span></div><div class="line"></div><div class="line">  <span class="function"><span class="keyword">def</span> <span class="title">first_name</span></span></div><div class="line">    @first_name</div><div class="line">  <span class="keyword">end</span></div><div class="line"></div><div class="line">  <span class="function"><span class="keyword">def</span> <span class="title">last_name</span></span></div><div class="line">    @last_name</div><div class="line">  <span class="keyword">end</span></div><div class="line"><span class="keyword">end</span></div><div class="line"></div><div class="line"><span class="comment"># 好</span></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span></span></div><div class="line">  <span class="keyword">attr_reader</span> <span class="symbol">:first_name</span>, <span class="symbol">:last_name</span></div><div class="line"></div><div class="line">  <span class="function"><span class="keyword">def</span> <span class="title">initialize</span><span class="params">(first_name, last_name)</span></span></div><div class="line">    @first_name = first_name</div><div class="line">    @last_name = last_name</div><div class="line">  <span class="keyword">end</span></div><div class="line"><span class="keyword">end</span></div></pre></td></tr></table></figure>
</li>
<li><p><a name="attr"></a><br>避免使用 <code>attr</code>。使用 <code>attr_reader</code> 与 <code>attr_accessor</code> 来替代。<br><sup>[<a href="#attr">link</a>]</sup></p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 差 - 创建单个存取方法（此方法在 Ruby 1.9 之后被移除了）</span></div><div class="line">attr <span class="symbol">:something</span>, <span class="literal">true</span></div><div class="line">attr <span class="symbol">:one</span>, <span class="symbol">:two</span>, <span class="symbol">:three</span> <span class="comment"># 类似于 attr_reader</span></div><div class="line"></div><div class="line"><span class="comment"># 好</span></div><div class="line"><span class="keyword">attr_accessor</span> <span class="symbol">:something</span></div><div class="line"><span class="keyword">attr_reader</span> <span class="symbol">:one</span>, <span class="symbol">:two</span>, <span class="symbol">:three</span></div></pre></td></tr></table></figure>
</li>
<li><p><a name="struct-new"></a><br>优先考虑使用 <code>Struct.new</code>。它替你定义了那些琐碎的访问器、构造器及比较操作符。<br><sup>[<a href="#struct-new">link</a>]</sup></p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 好</span></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span></span></div><div class="line">  <span class="keyword">attr_accessor</span> <span class="symbol">:first_name</span>, <span class="symbol">:last_name</span></div><div class="line"></div><div class="line">  <span class="function"><span class="keyword">def</span> <span class="title">initialize</span><span class="params">(first_name, last_name)</span></span></div><div class="line">    @first_name = first_name</div><div class="line">    @last_name = last_name</div><div class="line">  <span class="keyword">end</span></div><div class="line"><span class="keyword">end</span></div><div class="line"></div><div class="line"><span class="comment"># 更好</span></div><div class="line">Person = Struct.new(<span class="symbol">:first_name</span>, <span class="symbol">:last_name</span>) <span class="keyword">do</span></div><div class="line"><span class="keyword">end</span></div></pre></td></tr></table></figure>
</li>
<li><p><a name="no-extend-struct-new"></a><br>不要扩展 <code>Struct.new</code> 实例化后的对象。对它进行扩展不但引入了毫无意义的类层次，而且在此文件被多次引入时可能会产生奇怪的错误。<br><sup>[<a href="#no-extend-struct-new">link</a>]</sup></p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 差</span></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span> &lt; Struct.<span class="title">new</span>(:<span class="title">first_name</span>, :<span class="title">last_name</span>)</span></div><div class="line"><span class="keyword">end</span></div><div class="line"></div><div class="line"><span class="comment"># 好</span></div><div class="line">Person = Struct.new(<span class="symbol">:first_name</span>, <span class="symbol">:last_name</span>)</div></pre></td></tr></table></figure>
</li>
<li><p><a name="factory-methods"></a><br>优先考虑通过工厂方法的方式创建某些具有特定意义的实例对象。<br><sup>[<a href="#factory-methods">link</a>]</sup></p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span></span></div><div class="line">  <span class="function"><span class="keyword">def</span> <span class="title">self</span>.<span class="title">create</span><span class="params">(options_hash)</span></span></div><div class="line">    <span class="comment"># 省略主体</span></div><div class="line">  <span class="keyword">end</span></div><div class="line"><span class="keyword">end</span></div></pre></td></tr></table></figure>
</li>
<li><p><a name="duck-typing"></a><br>倾向使用<a href="https://en.wikipedia.org/wiki/Duck_typing" target="_blank" rel="external">鸭子类型</a>而不是继承。<br><sup>[<a href="#duck-typing">link</a>]</sup></p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 差</span></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Animal</span></span></div><div class="line">  <span class="comment"># 抽象方法</span></div><div class="line">  <span class="function"><span class="keyword">def</span> <span class="title">speak</span></span></div><div class="line">  <span class="keyword">end</span></div><div class="line"><span class="keyword">end</span></div><div class="line"></div><div class="line"><span class="comment"># 继承父类</span></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Duck</span> &lt; Animal</span></div><div class="line">  <span class="function"><span class="keyword">def</span> <span class="title">speak</span></span></div><div class="line">    puts <span class="string">'Quack! Quack'</span></div><div class="line">  <span class="keyword">end</span></div><div class="line"><span class="keyword">end</span></div><div class="line"></div><div class="line"><span class="comment"># 继承父类</span></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Dog</span> &lt; Animal</span></div><div class="line">  <span class="function"><span class="keyword">def</span> <span class="title">speak</span></span></div><div class="line">    puts <span class="string">'Bau! Bau!'</span></div><div class="line">  <span class="keyword">end</span></div><div class="line"><span class="keyword">end</span></div><div class="line"></div><div class="line"><span class="comment"># 好</span></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Duck</span></span></div><div class="line">  <span class="function"><span class="keyword">def</span> <span class="title">speak</span></span></div><div class="line">    puts <span class="string">'Quack! Quack'</span></div><div class="line">  <span class="keyword">end</span></div><div class="line"><span class="keyword">end</span></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Dog</span></span></div><div class="line">  <span class="function"><span class="keyword">def</span> <span class="title">speak</span></span></div><div class="line">    puts <span class="string">'Bau! Bau!'</span></div><div class="line">  <span class="keyword">end</span></div><div class="line"><span class="keyword">end</span></div></pre></td></tr></table></figure>
</li>
<li><p><a name="no-class-vars"></a><br>避免使用类变量（<code>@@</code>）。类变量在继承方面存在令人生厌的行为。<br><sup>[<a href="#no-class-vars">link</a>]</sup></p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Parent</span></span></div><div class="line">  @@class_var = <span class="string">'parent'</span></div><div class="line"></div><div class="line">  <span class="function"><span class="keyword">def</span> <span class="title">self</span>.<span class="title">print_class_var</span></span></div><div class="line">    puts @@class_var</div><div class="line">  <span class="keyword">end</span></div><div class="line"><span class="keyword">end</span></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Child</span> &lt; Parent</span></div><div class="line">  @@class_var = <span class="string">'child'</span></div><div class="line"><span class="keyword">end</span></div><div class="line"></div><div class="line">Parent.print_class_var <span class="comment"># =&gt; 此处打印的结果为 'child'</span></div></pre></td></tr></table></figure>
<p>如你所见，在类的层次结构中所有类都会共享同一类变量。通常情况下，倾向使用类实例变量而不是类变量。</p>
</li>
<li><p><a name="visibility"></a><br>根据方法的目的与用途设置适当的可见级别（<code>private</code>、<code>protected</code>）。不要什么都不做就把所有方法设置为 <code>public</code>（默认值）。毕竟我们写的是 <strong>Ruby</strong> 而不是 <strong>Python</strong>。<br><sup>[<a href="#visibility">link</a>]</sup></p>
</li>
<li><p><a name="indent-public-private-protected"></a><br>把 <code>public</code>、<code>protected</code>、<code>private</code> 与其作用的方法缩排在同一层级。且在其上下各留一行以强调此可见级别作用于之后的所有方法。<br><sup>[<a href="#indent-public-private-protected">link</a>]</sup></p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">SomeClass</span></span></div><div class="line">  <span class="function"><span class="keyword">def</span> <span class="title">public_method</span></span></div><div class="line">    <span class="comment"># ...</span></div><div class="line">  <span class="keyword">end</span></div><div class="line"></div><div class="line">  private</div><div class="line"></div><div class="line">  <span class="function"><span class="keyword">def</span> <span class="title">private_method</span></span></div><div class="line">    <span class="comment"># ...</span></div><div class="line">  <span class="keyword">end</span></div><div class="line"></div><div class="line">  <span class="function"><span class="keyword">def</span> <span class="title">another_private_method</span></span></div><div class="line">    <span class="comment"># ...</span></div><div class="line">  <span class="keyword">end</span></div><div class="line"><span class="keyword">end</span></div></pre></td></tr></table></figure>
</li>
<li><p><a name="def-self-class-methods"></a><br>使用 <code>def self.method</code> 定义类方法。这种做法使得在代码重构时，即使修改了类名也无需做多次修改。<br><sup>[<a href="#def-self-class-methods">link</a>]</sup></p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">TestClass</span></span></div><div class="line">  <span class="comment"># 差</span></div><div class="line">  <span class="function"><span class="keyword">def</span> <span class="title">TestClass</span>.<span class="title">some_method</span></span></div><div class="line">    <span class="comment"># 省略主体</span></div><div class="line">  <span class="keyword">end</span></div><div class="line"></div><div class="line">  <span class="comment"># 好</span></div><div class="line">  <span class="function"><span class="keyword">def</span> <span class="title">self</span>.<span class="title">some_other_method</span></span></div><div class="line">    <span class="comment"># 省略主体</span></div><div class="line">  <span class="keyword">end</span></div><div class="line"></div><div class="line">  <span class="comment"># 在需要定义多个类方法时，另一种便捷写法</span></div><div class="line">  <span class="class"><span class="keyword">class</span> &lt;&lt; self</span></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">first_method</span></span></div><div class="line">      <span class="comment"># 省略主体</span></div><div class="line">    <span class="keyword">end</span></div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">second_method_etc</span></span></div><div class="line">      <span class="comment"># 省略主体</span></div><div class="line">    <span class="keyword">end</span></div><div class="line">  <span class="keyword">end</span></div><div class="line"><span class="keyword">end</span></div></pre></td></tr></table></figure>
</li>
<li><p><a name="alias-method-lexically"></a><br>在类的词法作用域中定义方法别名时，倾向使用 <code>alias</code>。因为定义期间 <code>alias</code> 与 <code>self</code> 指向的都是词法作用域，除非明确说明，否则该别名所引用的方法不会在运行期间被改变，或是在任何子类中被修改。<br><sup>[<a href="#alias-method-lexically">link</a>]</sup></p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Westerner</span></span></div><div class="line">  <span class="function"><span class="keyword">def</span> <span class="title">first_name</span></span></div><div class="line">    @names.first</div><div class="line">  <span class="keyword">end</span></div><div class="line"></div><div class="line">  <span class="keyword">alias</span> given_name first_name</div><div class="line"><span class="keyword">end</span></div></pre></td></tr></table></figure>
<p>因为 <code>alias</code> 与 <code>def</code> 一样都是关键字，倾向使用裸字而不是符号或字符串。也就是说，使用 <code>alias foo bar</code> 而不是 <code>alias :foo :bar</code>。</p>
<p>另外需要了解 Ruby 是如何处理别名和继承的：别名所引用的原始方法是在定义期间被指定的，而不是运行期间。</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Fugitive</span> &lt; Westerner</span></div><div class="line">  <span class="function"><span class="keyword">def</span> <span class="title">first_name</span></span></div><div class="line">    <span class="string">'Nobody'</span></div><div class="line">  <span class="keyword">end</span></div><div class="line"><span class="keyword">end</span></div></pre></td></tr></table></figure>
<p>在这个例子中，<code>Fugitive#given_name</code> 仍然调用原先的 <code>Westerner#first_name</code> 方法，而不是 <code>Fugitive#first_name</code>。如果想要覆写 <code>Fugitive#given_name</code>，必须在子类中重新定义。</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Fugitive</span> &lt; Westerner</span></div><div class="line">  <span class="function"><span class="keyword">def</span> <span class="title">first_name</span></span></div><div class="line">    <span class="string">'Nobody'</span></div><div class="line">  <span class="keyword">end</span></div><div class="line"></div><div class="line">  <span class="keyword">alias</span> given_name first_name</div><div class="line"><span class="keyword">end</span></div></pre></td></tr></table></figure>
</li>
<li><p><a name="alias-method"></a><br>在运行期间定义模块方法、类方法、单件方法的别名时，总是使用 <code>alias_method</code>。在上述情况下，使用 <code>alias</code> 可能会导致预期之外的结果。<br><sup>[<a href="#alias-method">link</a>]</sup></p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">module</span> <span class="title">Mononymous</span></span></div><div class="line">  <span class="function"><span class="keyword">def</span> <span class="title">self</span>.<span class="title">included</span><span class="params">(other)</span></span></div><div class="line">    other.class_eval &#123; alias_method <span class="symbol">:full_name</span>, <span class="symbol">:given_name</span> &#125;</div><div class="line">  <span class="keyword">end</span></div><div class="line"><span class="keyword">end</span></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Sting</span> &lt; Westerner</span></div><div class="line">  <span class="keyword">include</span> Mononymous</div><div class="line"><span class="keyword">end</span></div></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="异常"><a href="#异常" class="headerlink" title="异常"></a>异常</h2><ul>
<li><p><a name="prefer-raise-over-fail"></a><br>对于异常处理，倾向使用 <code>raise</code> 而不是 <code>fail</code>。<br><sup>[<a href="#prefer-raise-over-fail">link</a>]</sup></p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 差</span></div><div class="line">fail SomeException, <span class="string">'message'</span></div><div class="line"></div><div class="line"><span class="comment"># 好</span></div><div class="line">raise SomeException, <span class="string">'message'</span></div></pre></td></tr></table></figure>
</li>
<li><p><a name="no-explicit-runtimeerror"></a><br>不要在带双参数形式的 <code>raise</code> 方法中显式指定 <code>RuntimeError</code>。<br><sup>[<a href="#no-explicit-runtimeerror">link</a>]</sup></p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 差</span></div><div class="line">raise RuntimeError, <span class="string">'message'</span></div><div class="line"></div><div class="line"><span class="comment"># 好 - 默认就是 RuntimeError</span></div><div class="line">raise <span class="string">'message'</span></div></pre></td></tr></table></figure>
</li>
<li><p><a name="exception-class-messages"></a><br>倾向使用带异常类、消息的双参数形式调用 <code>raise</code> 方法，而不是使用异常的实例。<br><sup>[<a href="#exception-class-messages">link</a>]</sup></p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 差 - 并无 raise SomeException.new('message') [, backtraces] 这种调用形式</span></div><div class="line">raise SomeException.new(<span class="string">'message'</span>)</div><div class="line"></div><div class="line"><span class="comment"># 好 - 与调用形式 raise SomeException [, 'message' [, backtraces]] 保持一致</span></div><div class="line">raise SomeException, <span class="string">'message'</span></div></pre></td></tr></table></figure>
</li>
<li><p><a name="no-return-ensure"></a><br>永远不要从 <code>ensure</code> 区块返回。如果你显式地从 <code>ensure</code> 区块返回，那么其所在的方法会如同永远不会发生异常般的返回。事实上，异常被默默地丢弃了。<br><sup>[<a href="#no-return-ensure">link</a>]</sup></p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">foo</span></span></div><div class="line">  raise</div><div class="line"><span class="keyword">ensure</span></div><div class="line">  <span class="keyword">return</span> <span class="string">'very bad idea'</span></div><div class="line"><span class="keyword">end</span></div></pre></td></tr></table></figure>
</li>
<li><p><a name="begin-implicit"></a><br>尽可能隐式地使用 <code>begin/rescue/ensure/end</code> 区块。<br><sup>[<a href="#begin-implicit">link</a>]</sup></p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 差</span></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">foo</span></span></div><div class="line">  <span class="keyword">begin</span></div><div class="line">    <span class="comment"># 主逻辑</span></div><div class="line">  <span class="keyword">rescue</span></div><div class="line">    <span class="comment"># 异常处理逻辑</span></div><div class="line">  <span class="keyword">end</span></div><div class="line"><span class="keyword">end</span></div><div class="line"></div><div class="line"><span class="comment"># 好</span></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">foo</span></span></div><div class="line">  <span class="comment"># 主逻辑</span></div><div class="line"><span class="keyword">rescue</span></div><div class="line">  <span class="comment"># 异常处理逻辑</span></div><div class="line"><span class="keyword">end</span></div></pre></td></tr></table></figure>
</li>
<li><p><a name="contingency-methods"></a><br>通过使用 <strong>contingency 方法</strong>（一个由 Avdi Grimm 创造的词）来减少 <code>begin/rescue/ensure/end</code> 区块的使用。<br><sup>[<a href="#contingency-methods">link</a>]</sup></p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 差</span></div><div class="line"><span class="keyword">begin</span></div><div class="line">  something_that_might_fail</div><div class="line"><span class="keyword">rescue</span> IOError</div><div class="line">  <span class="comment"># 处理 IOError</span></div><div class="line"><span class="keyword">end</span></div><div class="line"></div><div class="line"><span class="keyword">begin</span></div><div class="line">  something_else_that_might_fail</div><div class="line"><span class="keyword">rescue</span> IOError</div><div class="line">  <span class="comment"># 处理 IOError</span></div><div class="line"><span class="keyword">end</span></div><div class="line"></div><div class="line"><span class="comment"># 好</span></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">with_io_error_handling</span></span></div><div class="line">   <span class="keyword">yield</span></div><div class="line"><span class="keyword">rescue</span> IOError</div><div class="line">  <span class="comment"># 处理 IOError</span></div><div class="line"><span class="keyword">end</span></div><div class="line"></div><div class="line">with_io_error_handling &#123; something_that_might_fail &#125;</div><div class="line"></div><div class="line">with_io_error_handling &#123; something_else_that_might_fail &#125;</div></pre></td></tr></table></figure>
</li>
<li><p><a name="dont-hide-exceptions"></a><br>不要抑制异常。<br><sup>[<a href="#dont-hide-exceptions">link</a>]</sup></p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 差</span></div><div class="line"><span class="keyword">begin</span></div><div class="line">  <span class="comment"># 抛出异常</span></div><div class="line"><span class="keyword">rescue</span> SomeError</div><div class="line">  <span class="comment"># 不做任何相关处理</span></div><div class="line"><span class="keyword">end</span></div><div class="line"></div><div class="line"><span class="comment"># 差</span></div><div class="line">do_something <span class="keyword">rescue</span> <span class="literal">nil</span></div></pre></td></tr></table></figure>
</li>
<li><p><a name="no-rescue-modifiers"></a><br>避免使用 <code>rescue</code> 修饰语法。<br><sup>[<a href="#no-rescue-modifiers">link</a>]</sup></p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 差 - 这里将会捕捉 StandardError 及其所有子孙类的异常</span></div><div class="line">read_file <span class="keyword">rescue</span> handle_error($!)</div><div class="line"></div><div class="line"><span class="comment"># 好 - 这里只会捕获 Errno::ENOENT 及其所有子孙类的异常</span></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">foo</span></span></div><div class="line">  read_file</div><div class="line"><span class="keyword">rescue</span> Errno::ENOENT =&gt; ex</div><div class="line">  handle_error(ex)</div><div class="line"><span class="keyword">end</span></div></pre></td></tr></table></figure>
</li>
<li><p><a name="no-exceptional-flows"></a><br>不要将异常处理作为流程控制使用。<br><sup>[<a href="#no-exceptional-flows">link</a>]</sup></p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 差</span></div><div class="line"><span class="keyword">begin</span></div><div class="line">  n / d</div><div class="line"><span class="keyword">rescue</span> ZeroDivisionError</div><div class="line">  puts <span class="string">'Cannot divide by 0!'</span></div><div class="line"><span class="keyword">end</span></div><div class="line"></div><div class="line"><span class="comment"># 好</span></div><div class="line"><span class="keyword">if</span> d.zero?</div><div class="line">  puts <span class="string">'Cannot divide by 0!'</span></div><div class="line"><span class="keyword">else</span></div><div class="line">  n / d</div><div class="line"><span class="keyword">end</span></div></pre></td></tr></table></figure>
</li>
<li><p><a name="no-blind-rescues"></a><br>避免捕获 <code>Exception</code>。这种做法会同时将信号与 <code>exit</code> 方法困住，导致你必须使用 <code>kill -9</code> 来终止进程。<br><sup>[<a href="#no-blind-rescues">link</a>]</sup></p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 差 - 信号与 exit 方法产生的异常会被捕获（除了 kill -9）</span></div><div class="line"><span class="keyword">begin</span></div><div class="line">  exit</div><div class="line"><span class="keyword">rescue</span> Exception</div><div class="line">  puts <span class="string">"you didn't really want to exit, right?"</span></div><div class="line">  <span class="comment"># 处理异常</span></div><div class="line"><span class="keyword">end</span></div><div class="line"></div><div class="line"><span class="comment"># 好 - 没有指定具体异常的 rescue 子句默认捕获 StandardError</span></div><div class="line"><span class="keyword">begin</span></div><div class="line">  <span class="comment"># 抛出异常</span></div><div class="line"><span class="keyword">rescue</span> =&gt; e</div><div class="line">  <span class="comment"># 处理异常</span></div><div class="line"><span class="keyword">end</span></div><div class="line"></div><div class="line"><span class="comment"># 好 - 指定具体异常 StandardError</span></div><div class="line"><span class="keyword">begin</span></div><div class="line">  <span class="comment"># 抛出异常</span></div><div class="line"><span class="keyword">rescue</span> StandardError =&gt; e</div><div class="line">  <span class="comment"># 处理异常</span></div><div class="line"><span class="keyword">end</span></div></pre></td></tr></table></figure>
</li>
<li><p><a name="exception-ordering"></a><br>把较具体的异常放在处理链的较上层，不然它们永远不会被执行。<br><sup>[<a href="#exception-ordering">link</a>]</sup></p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 差</span></div><div class="line"><span class="keyword">begin</span></div><div class="line">  <span class="comment"># 抛出异常</span></div><div class="line"><span class="keyword">rescue</span> StandardError =&gt; e</div><div class="line">  <span class="comment"># 处理异常</span></div><div class="line"><span class="keyword">rescue</span> IOError =&gt; e</div><div class="line">  <span class="comment"># 处理异常，但事实上永远不会被执行</span></div><div class="line"><span class="keyword">end</span></div><div class="line"></div><div class="line"><span class="comment"># 好</span></div><div class="line"><span class="keyword">begin</span></div><div class="line">  <span class="comment"># 抛出异常</span></div><div class="line"><span class="keyword">rescue</span> IOError =&gt; e</div><div class="line">  <span class="comment"># 处理异常</span></div><div class="line"><span class="keyword">rescue</span> StandardError =&gt; e</div><div class="line">  <span class="comment"># 处理异常</span></div><div class="line"><span class="keyword">end</span></div></pre></td></tr></table></figure>
</li>
<li><p><a name="release-resources"></a><br>在 <code>ensure</code> 区块释放程序的外部资源。<br><sup>[<a href="#release-resources">link</a>]</sup></p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">f = File.open(<span class="string">'testfile'</span>)</div><div class="line"><span class="keyword">begin</span></div><div class="line">  <span class="comment"># .. 文件操作</span></div><div class="line"><span class="keyword">rescue</span></div><div class="line">  <span class="comment"># .. 处理异常</span></div><div class="line"><span class="keyword">ensure</span></div><div class="line">  f.close <span class="keyword">if</span> f</div><div class="line"><span class="keyword">end</span></div></pre></td></tr></table></figure>
</li>
<li><p><a name="auto-release-resources"></a><br>在调用资源获取方法时，尽量使用具备自动清理功能的版本。<br><sup>[<a href="#auto-release-resources">link</a>]</sup></p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 差 - 需要显式关闭文件描述符</span></div><div class="line">f = File.open(<span class="string">'testfile'</span>)</div><div class="line">  <span class="comment"># ...</span></div><div class="line">f.close</div><div class="line"></div><div class="line"><span class="comment"># 好 - 文件描述符会被自动关闭</span></div><div class="line">File.open(<span class="string">'testfile'</span>) <span class="keyword">do</span> <span class="params">|f|</span></div><div class="line">  <span class="comment"># ...</span></div><div class="line"><span class="keyword">end</span></div></pre></td></tr></table></figure>
</li>
<li><p><a name="standard-exceptions"></a><br>倾向使用标准库中的异常类而不是引入新的类型。<br><sup>[<a href="#standard-exceptions">link</a>]</sup></p>
</li>
</ul>
<h2 id="集合"><a href="#集合" class="headerlink" title="集合"></a>集合</h2><ul>
<li><p><a name="literal-array-hash"></a><br>对于数组与哈希，倾向使用字面量语法来构建实例（除非你需要给构造器传递参数）。<br><sup>[<a href="#literal-array-hash">link</a>]</sup></p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 差</span></div><div class="line">arr = Array.new</div><div class="line">hash = Hash.new</div><div class="line"></div><div class="line"><span class="comment"># 好</span></div><div class="line">arr = []</div><div class="line">hash = &#123;&#125;</div></pre></td></tr></table></figure>
</li>
<li><p><a name="percent-w"></a><br>当创建一组元素为单词（没有空格或特殊字符）的数组时，倾向使用 <code>%w</code> 而不是 <code>[]</code>。此规则只适用于数组元素有两个或以上的时候。<br><sup>[<a href="#percent-w">link</a>]</sup></p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 差</span></div><div class="line">STATES = [<span class="string">'draft'</span>, <span class="string">'open'</span>, <span class="string">'closed'</span>]</div><div class="line"></div><div class="line"><span class="comment"># 好</span></div><div class="line">STATES = <span class="string">%w(draft open closed)</span></div></pre></td></tr></table></figure>
</li>
<li><p><a name="percent-i"></a><br>当创建一组符号类型的数组（且不需要保持 Ruby 1.9 兼容性）时，倾向使用 <code>%i</code>。此规则只适用于数组元素有两个或以上的时候。<br><sup>[<a href="#percent-i">link</a>]</sup></p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 差</span></div><div class="line">STATES = [<span class="symbol">:draft</span>, <span class="symbol">:open</span>, <span class="symbol">:closed</span>]</div><div class="line"></div><div class="line"><span class="comment"># 好</span></div><div class="line">STATES = %i(draft open closed)</div></pre></td></tr></table></figure>
</li>
<li><p><a name="no-trailing-array-commas"></a><br>避免在数组与哈希的字面量语法的最后一个元素之后添加逗号，尤其当元素没有分布在同一行时。<br><sup>[<a href="#no-trailing-array-commas">link</a>]</sup></p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 差 - 尽管移动、新增、删除元素颇为方便，但仍不推荐这种写法</span></div><div class="line">VALUES = [</div><div class="line">           <span class="number">1001</span>,</div><div class="line">           <span class="number">2020</span>,</div><div class="line">           <span class="number">3333</span>,</div><div class="line">         ]</div><div class="line"></div><div class="line"><span class="comment"># 差</span></div><div class="line">VALUES = [<span class="number">1001</span>, <span class="number">2020</span>, <span class="number">3333</span>, ]</div><div class="line"></div><div class="line"><span class="comment"># 好</span></div><div class="line">VALUES = [<span class="number">1001</span>, <span class="number">2020</span>, <span class="number">3333</span>]</div></pre></td></tr></table></figure>
</li>
<li><p><a name="no-gappy-arrays"></a><br>避免在数组中创造巨大的间隔。<br><sup>[<a href="#no-gappy-arrays">link</a>]</sup></p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">arr = []</div><div class="line">arr[<span class="number">100</span>] = <span class="number">1</span> <span class="comment"># 现在你有一个很多 nil 的数组</span></div></pre></td></tr></table></figure>
</li>
<li><p><a name="first-and-last"></a><br>当访问数组的首元素或尾元素时，倾向使用 <code>first</code> 或 <code>last</code> 而不是 <code>[0]</code> 或 <code>[-1]</code>。<br><sup>[<a href="#first-and-last">link</a>]</sup></p>
</li>
<li><p><a name="set-vs-array"></a><br>当处理的对象不存在重复元素时，使用 <code>Set</code> 来替代 <code>Array</code>。<code>Set</code> 是实现了无序且无重复元素的集合类型。它兼具 <code>Array</code> 的直观操作与 <code>Hash</code> 的快速查找。<br><sup>[<a href="#set-vs-array">link</a>]</sup></p>
</li>
<li><p><a name="symbols-as-keys"></a><br>倾向使用符号而不是字符串作为哈希键。<br><sup>[<a href="#symbols-as-keys">link</a>]</sup></p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 差</span></div><div class="line">hash = &#123; <span class="string">'one'</span> =&gt; <span class="number">1</span>, <span class="string">'two'</span> =&gt; <span class="number">2</span>, <span class="string">'three'</span> =&gt; <span class="number">3</span> &#125;</div><div class="line"></div><div class="line"><span class="comment"># 好</span></div><div class="line">hash = &#123; <span class="symbol">one:</span> <span class="number">1</span>, <span class="symbol">two:</span> <span class="number">2</span>, <span class="symbol">three:</span> <span class="number">3</span> &#125;</div></pre></td></tr></table></figure>
</li>
<li><p><a name="no-mutable-keys"></a><br>避免使用可变对象作为哈希键。<br><sup>[<a href="#no-mutable-keys">link</a>]</sup></p>
</li>
<li><p><a name="hash-literals"></a><br>当哈希键为符号时，使用 Ruby 1.9 的字面量语法。<br><sup>[<a href="#hash-literals">link</a>]</sup></p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 差</span></div><div class="line">hash = &#123; <span class="symbol">:one</span> =&gt; <span class="number">1</span>, <span class="symbol">:two</span> =&gt; <span class="number">2</span>, <span class="symbol">:three</span> =&gt; <span class="number">3</span> &#125;</div><div class="line"></div><div class="line"><span class="comment"># 好</span></div><div class="line">hash = &#123; <span class="symbol">one:</span> <span class="number">1</span>, <span class="symbol">two:</span> <span class="number">2</span>, <span class="symbol">three:</span> <span class="number">3</span> &#125;</div></pre></td></tr></table></figure>
</li>
<li><p><a name="no-mixed-hash-syntaces"></a><br>当哈希键既有符号又有字符串时，不要使用 Ruby 1.9 的字面量语法。<br><sup>[<a href="#no-mixed-hash-syntaces">link</a>]</sup></p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 差</span></div><div class="line">&#123; <span class="symbol">a:</span> <span class="number">1</span>, <span class="string">'b'</span> =&gt; <span class="number">2</span> &#125;</div><div class="line"></div><div class="line"><span class="comment"># 好</span></div><div class="line">&#123; <span class="symbol">:a</span> =&gt; <span class="number">1</span>, <span class="string">'b'</span> =&gt; <span class="number">2</span> &#125;</div></pre></td></tr></table></figure>
</li>
<li><p><a name="hash-key"></a><br>倾向使用 <code>Hash#key?</code> 而不是 <code>Hash#has_key?</code>，使用 <code>Hash#value?</code> 而不是 <code>Hash#has_value?</code>。Matz <a href="http://blade.nagaokaut.ac.jp/cgi-bin/scat.rb/ruby/ruby-core/43765" target="_blank" rel="external">在此</a>提及，较长形式的方法将被废弃。<br><sup>[<a href="#hash-key">link</a>]</sup></p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 差</span></div><div class="line">hash.has_key?(<span class="symbol">:test</span>)</div><div class="line">hash.has_value?(value)</div><div class="line"></div><div class="line"><span class="comment"># 好</span></div><div class="line">hash.key?(<span class="symbol">:test</span>)</div><div class="line">hash.value?(value)</div></pre></td></tr></table></figure>
</li>
<li><p><a name="hash-each"></a><br>倾向使用 <code>Hash#each_key</code> 而不是 <code>Hash#keys.each</code>，使用 <code>Hash#each_value</code> 而不是 <code>Hash#values.each</code>。<br><sup>[<a href="#hash-each">link</a>]</sup></p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 差</span></div><div class="line">hash.keys.each &#123; <span class="params">|k|</span> p k &#125;</div><div class="line">hash.values.each &#123; <span class="params">|v|</span> p v &#125;</div><div class="line">hash.each &#123; <span class="params">|k, _v|</span> p k &#125;</div><div class="line">hash.each &#123; <span class="params">|_k, v|</span> p v &#125;</div><div class="line"></div><div class="line"><span class="comment"># 好</span></div><div class="line">hash.each_key &#123; <span class="params">|k|</span> p k &#125;</div><div class="line">hash.each_value &#123; <span class="params">|v|</span> p v &#125;</div></pre></td></tr></table></figure>
</li>
<li><p><a name="hash-fetch"></a><br>当处理应该存在的哈希键时，使用 <code>Hash#fetch</code>。<br><sup>[<a href="#hash-fetch">link</a>]</sup></p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">heroes = &#123; <span class="symbol">batman:</span> <span class="string">'Bruce Wayne'</span>, <span class="symbol">superman:</span> <span class="string">'Clark Kent'</span> &#125;</div><div class="line"></div><div class="line"><span class="comment"># 差 - 如果我们打错了哈希键，则难以发现这个错误</span></div><div class="line">heroes[<span class="symbol">:batman</span>] <span class="comment"># =&gt; 'Bruce Wayne'</span></div><div class="line">heroes[<span class="symbol">:supermann</span>] <span class="comment"># =&gt; nil</span></div><div class="line"></div><div class="line"><span class="comment"># 好 - fetch 会抛出 KeyError 使这个错误显而易见</span></div><div class="line">heroes.fetch(<span class="symbol">:supermann</span>)</div></pre></td></tr></table></figure>
</li>
<li><p><a name="hash-fetch-defaults"></a><br>当为哈希键的值提供默认值时，倾向使用 <code>Hash#fetch</code> 而不是自定义逻辑。<br><sup>[<a href="#hash-fetch-defaults">link</a>]</sup></p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">batman = &#123; <span class="symbol">name:</span> <span class="string">'Bruce Wayne'</span>, <span class="symbol">is_evil:</span> <span class="literal">false</span> &#125;</div><div class="line"></div><div class="line"><span class="comment"># 差 - 如果仅仅使用 || 操作符，那么当值为假时，我们不会得到预期结果</span></div><div class="line">batman[<span class="symbol">:is_evil</span>] <span class="params">||</span> <span class="literal">true</span> <span class="comment"># =&gt; true</span></div><div class="line"></div><div class="line"><span class="comment"># 好 - fetch 在遇到假值时依然可以正确工作</span></div><div class="line">batman.fetch(<span class="symbol">:is_evil</span>, <span class="literal">true</span>) <span class="comment"># =&gt; false</span></div></pre></td></tr></table></figure>
</li>
<li><p><a name="use-hash-blocks"></a><br>当提供默认值的求值代码具有副作用或开销较大时，倾向使用 <code>Hash#fetch</code> 的区块形式。<br><sup>[<a href="#use-hash-blocks">link</a>]</sup></p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">batman = &#123; <span class="symbol">name:</span> <span class="string">'Bruce Wayne'</span> &#125;</div><div class="line"></div><div class="line"><span class="comment"># 差 - 此形式会立即求值，如果调用多次，可能会影响程序的性能</span></div><div class="line">batman.fetch(<span class="symbol">:powers</span>, obtain_batman_powers) <span class="comment"># obtain_batman_powers 开销较大</span></div><div class="line"></div><div class="line"><span class="comment"># 好 - 此形式会惰性求值，只有抛出 KeyError 时，才会产生开销</span></div><div class="line">batman.fetch(<span class="symbol">:powers</span>) &#123; obtain_batman_powers &#125;</div></pre></td></tr></table></figure>
</li>
<li><p><a name="hash-values-at"></a><br>当需要一次性从哈希中获取多个键的值时，使用 <code>Hash#values_at</code>。<br><sup>[<a href="#hash-values-at">link</a>]</sup></p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 差</span></div><div class="line">email = data[<span class="string">'email'</span>]</div><div class="line">username = data[<span class="string">'nickname'</span>]</div><div class="line"></div><div class="line"><span class="comment"># 好</span></div><div class="line">email, username = data.values_at(<span class="string">'email'</span>, <span class="string">'nickname'</span>)</div></pre></td></tr></table></figure>
</li>
<li><p><a name="ordered-hashes"></a><br>利用“Ruby 1.9 之后的哈希是有序的”的这个特性。<br><sup>[<a href="#ordered-hashes">link</a>]</sup></p>
</li>
<li><p><a name="no-modifying-collections"></a><br>当遍历集合时，不要改动它。<br><sup>[<a href="#no-modifying-collections">link</a>]</sup></p>
</li>
<li><p><a name="accessing-elements-directly"></a><br>当访问集合中的元素时，倾向使用对象所提供的方法进行访问，而不是直接调用对象属性上的 <code>[n]</code> 方法。这种做法可以防止你在 <code>nil</code> 对象上调用 <code>[]</code>。<br><sup>[<a href="#accessing-elements-directly">link</a>]</sup></p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 差</span></div><div class="line">Regexp.last_match[<span class="number">1</span>]</div><div class="line"></div><div class="line"><span class="comment"># 好</span></div><div class="line">Regexp.last_match(<span class="number">1</span>)</div></pre></td></tr></table></figure>
</li>
<li><p><a name="provide-alternate-accessor-to-collections"></a><br>当为集合提供存取器时，尽量支持索引值为 <code>nil</code> 的访问形式。<br><sup>[<a href="#provide-alternate-accessor-to-collections">link</a>]</sup></p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 差</span></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">awesome_things</span></span></div><div class="line">  @awesome_things</div><div class="line"><span class="keyword">end</span></div><div class="line"></div><div class="line"><span class="comment"># 好</span></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">awesome_things</span><span class="params">(index = <span class="literal">nil</span>)</span></span></div><div class="line">  <span class="keyword">if</span> index &amp;&amp; @awesome_things</div><div class="line">    @awesome_things[index]</div><div class="line">  <span class="keyword">else</span></div><div class="line">    @awesome_things</div><div class="line">  <span class="keyword">end</span></div><div class="line"><span class="keyword">end</span></div></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="数值"><a href="#数值" class="headerlink" title="数值"></a>数值</h2><ul>
<li><p><a name="integer-type-checking"></a><br>通过 <code>Integer</code> 检查对象是否是数值类型，而不是 <code>Fixnum</code> 或 <code>Bignum</code>。因为 <code>Fixnum</code> 或 <code>Bignum</code> 表达的数值大小存在范围限定。<br><sup>[<a href="#integer-type-checking">link</a>]</sup></p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">timestamp = Time.now.to_i</div><div class="line"></div><div class="line"><span class="comment"># 差</span></div><div class="line">timestamp.is_a? Fixnum</div><div class="line">timestamp.is_a? Bignum</div><div class="line"></div><div class="line"><span class="comment"># 好</span></div><div class="line">timestamp.is_a? Integer</div></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="字符串"><a href="#字符串" class="headerlink" title="字符串"></a>字符串</h2><ul>
<li><p><a name="string-interpolation"></a><br>倾向使用字符串插值或字符串格式化，而不是字符串拼接。<br><sup>[<a href="#string-interpolation">link</a>]</sup></p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 差</span></div><div class="line">email_with_name = user.name + <span class="string">' &lt;'</span> + user.email + <span class="string">'&gt;'</span></div><div class="line"></div><div class="line"><span class="comment"># 好</span></div><div class="line">email_with_name = <span class="string">"<span class="subst">#&#123;user.name&#125;</span> &lt;<span class="subst">#&#123;user.email&#125;</span>&gt;"</span></div><div class="line"></div><div class="line"><span class="comment"># 好</span></div><div class="line">email_with_name = format(<span class="string">'%s &lt;%s&gt;'</span>, user.name, user.email)</div></pre></td></tr></table></figure>
</li>
<li><p><a name="consistent-string-literals"></a><br>使用统一的风格创建字符串字面量。在 Ruby 社区中存在两种流行的风格：默认单引号（风格 A）与默认双引号（风格 B）。<br><sup>[<a href="#consistent-string-literals">link</a>]</sup></p>
<ul>
<li><p><strong>（风格 A）</strong> 当你不需要字符串插值或特殊字符（比如 <code>\t</code>、<code>\n</code>、<code>&#39;</code>）时，倾向使用单引号。</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 差</span></div><div class="line">name = <span class="string">"Bozhidar"</span></div><div class="line"></div><div class="line"><span class="comment"># 好</span></div><div class="line">name = <span class="string">'Bozhidar'</span></div></pre></td></tr></table></figure>
</li>
<li><p><strong>（风格 B）</strong> 除非字符串中包含双引号，或是你希望抑制转义字符，否则倾向使用双引号。</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 差</span></div><div class="line">name = <span class="string">'Bozhidar'</span></div><div class="line"></div><div class="line"><span class="comment"># 好</span></div><div class="line">name = <span class="string">"Bozhidar"</span></div></pre></td></tr></table></figure>
</li>
</ul>
<p>本指南使用第一种风格。</p>
</li>
<li><p><a name="no-character-literals"></a><br>不要使用 <code>?x</code> 字面量语法。在 Ruby 1.9 之后，<code>?x</code> 与 <code>&#39;x&#39;</code>（只包含单个字符的字符串）是等价的。<br><sup>[<a href="#no-character-literals">link</a>]</sup></p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 差</span></div><div class="line">char = <span class="string">?c</span></div><div class="line"></div><div class="line"><span class="comment"># 好</span></div><div class="line">char = <span class="string">'c'</span></div></pre></td></tr></table></figure>
</li>
<li><p><a name="curlies-interpolate"></a><br>不要忘记使用 <code>{}</code> 包裹字符串插值中的实例变量或全局变量。<br><sup>[<a href="#curlies-interpolate">link</a>]</sup></p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span></span></div><div class="line">  <span class="keyword">attr_reader</span> <span class="symbol">:first_name</span>, <span class="symbol">:last_name</span></div><div class="line"></div><div class="line">  <span class="function"><span class="keyword">def</span> <span class="title">initialize</span><span class="params">(first_name, last_name)</span></span></div><div class="line">    @first_name = first_name</div><div class="line">    @last_name = last_name</div><div class="line">  <span class="keyword">end</span></div><div class="line"></div><div class="line">  <span class="comment"># 差 - 语法正确，但略显笨拙</span></div><div class="line">  <span class="function"><span class="keyword">def</span> <span class="title">to_s</span></span></div><div class="line">    <span class="string">"#@first_name #@last_name"</span></div><div class="line">  <span class="keyword">end</span></div><div class="line"></div><div class="line">  <span class="comment"># 好</span></div><div class="line">  <span class="function"><span class="keyword">def</span> <span class="title">to_s</span></span></div><div class="line">    <span class="string">"<span class="subst">#&#123;@first_name&#125;</span> <span class="subst">#&#123;@last_name&#125;</span>"</span></div><div class="line">  <span class="keyword">end</span></div><div class="line"><span class="keyword">end</span></div><div class="line"></div><div class="line">$global = <span class="number">0</span></div><div class="line"></div><div class="line"><span class="comment"># 差</span></div><div class="line">puts <span class="string">"$global = #$global"</span></div><div class="line"></div><div class="line"><span class="comment"># 好</span></div><div class="line">puts <span class="string">"$global = <span class="subst">#&#123;$global&#125;</span>"</span></div></pre></td></tr></table></figure>
</li>
<li><p><a name="no-to-s"></a><br>在字符串插值中，不要显式调用 <code>Object#to_s</code> 方法，Ruby 会自动调用它。<br><sup>[<a href="#no-to-s">link</a>]</sup></p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 差</span></div><div class="line">message = <span class="string">"This is the <span class="subst">#&#123;result.to_s&#125;</span>."</span></div><div class="line"></div><div class="line"><span class="comment"># 好</span></div><div class="line">message = <span class="string">"This is the <span class="subst">#&#123;result&#125;</span>."</span></div></pre></td></tr></table></figure>
</li>
<li><p><a name="concat-strings"></a><br>当你需要构造巨大的数据块时，避免使用 <code>String#+</code>，使用 <code>String#&lt;&lt;</code> 来替代。<code>String#&lt;&lt;</code> 通过修改原始对象进行拼接工作，其比 <code>String#+</code> 效率更高，因为后者需要产生一堆新的字符串对象。<br><sup>[<a href="#concat-strings">link</a>]</sup></p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 差</span></div><div class="line">html = <span class="string">''</span></div><div class="line">html += <span class="string">'&lt;h1&gt;Page title&lt;/h1&gt;'</span></div><div class="line"></div><div class="line">paragraphs.each <span class="keyword">do</span> <span class="params">|paragraph|</span></div><div class="line">  html += <span class="string">"&lt;p&gt;<span class="subst">#&#123;paragraph&#125;</span>&lt;/p&gt;"</span></div><div class="line"><span class="keyword">end</span></div><div class="line"></div><div class="line"><span class="comment"># 好 - 并且效率更高</span></div><div class="line">html = <span class="string">''</span></div><div class="line">html &lt;&lt; <span class="string">'&lt;h1&gt;Page title&lt;/h1&gt;'</span></div><div class="line"></div><div class="line">paragraphs.each <span class="keyword">do</span> <span class="params">|paragraph|</span></div><div class="line">  html &lt;&lt; <span class="string">"&lt;p&gt;<span class="subst">#&#123;paragraph&#125;</span>&lt;/p&gt;"</span></div><div class="line"><span class="keyword">end</span></div></pre></td></tr></table></figure>
</li>
<li><p><a name="dont-abuse-gsub"></a><br>当存在更快速、更专业的替代方案时，不要使用 <code>String#gsub</code>。<br><sup>[<a href="#dont-abuse-gsub">link</a>]</sup></p>
  <figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">url = <span class="string">'http://example.com'</span></div><div class="line">str = <span class="string">'lisp-case-rules'</span></div><div class="line"></div><div class="line"><span class="comment"># 差</span></div><div class="line">url.gsub(<span class="string">'http://'</span>, <span class="string">'https://'</span>)</div><div class="line">str.gsub(<span class="string">'-'</span>, <span class="string">'_'</span>)</div><div class="line"></div><div class="line"><span class="comment"># 好</span></div><div class="line">url.sub(<span class="string">'http://'</span>, <span class="string">'https://'</span>)</div><div class="line">str.tr(<span class="string">'-'</span>, <span class="string">'_'</span>)</div></pre></td></tr></table></figure>
</li>
<li><p><a name="heredocs"></a><br>heredocs 中的多行文本会保留各行的前导空白。因此做好如何缩排的规划。<br><sup>[<a href="#heredocs">link</a>]</sup></p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">code = &lt;&lt;-<span class="keyword">END</span>.gsub(<span class="regexp">/^\s+\|/</span>, <span class="string">''</span>)</div><div class="line">  <span class="params">|def test</span></div><div class="line">  |  some_method</div><div class="line">  <span class="params">|  other_method</span></div><div class="line">  |<span class="keyword">end</span></div><div class="line"><span class="keyword">END</span></div><div class="line"><span class="comment"># =&gt; "def test\n  some_method\n  other_method\nend\n"</span></div></pre></td></tr></table></figure>
</li>
<li><p><a name="squiggly-heredocs"></a><br>使用 Ruby 2.3 新增的 <code>&lt;&lt;~</code> 操作符来缩排 heredocs 中的多行文本。<br><sup>[<a href="#squiggly-heredocs">link</a>]</sup></p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 差 - 使用 Powerpack 程序库的 String#strip_margin</span></div><div class="line">code = &lt;&lt;-<span class="keyword">END</span>.strip_margin(<span class="string">'|'</span>)</div><div class="line">  <span class="params">|def test</span></div><div class="line">  |  some_method</div><div class="line">  <span class="params">|  other_method</span></div><div class="line">  |<span class="keyword">end</span></div><div class="line"><span class="keyword">END</span></div><div class="line"></div><div class="line"><span class="comment"># 差</span></div><div class="line">code = <span class="string">&lt;&lt;-END</span></div><div class="line">def test</div><div class="line">  some_method</div><div class="line">  other_method</div><div class="line"><span class="keyword">end</span></div><div class="line"><span class="keyword">END</span></div><div class="line"></div><div class="line"><span class="comment"># 好</span></div><div class="line">code = &lt;&lt;~<span class="keyword">END</span></div><div class="line">  <span class="function"><span class="keyword">def</span> <span class="title">test</span></span></div><div class="line">    some_method</div><div class="line">    other_method</div><div class="line">  <span class="keyword">end</span></div><div class="line"><span class="keyword">END</span></div></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="正则表达式"><a href="#正则表达式" class="headerlink" title="正则表达式"></a>正则表达式</h2><blockquote>
<p>有些人在面对问题时，不经大脑便认为，“我知道，这里该用正则表达式”。现在他要面对两个问题了。<br><br>——Jamie Zawinski</p>
</blockquote>
<ul>
<li><p><a name="no-regexp-for-plaintext"></a><br>如果只是在字符串中进行简单的文本搜索，不要使用正则表达式，比如 <code>string[&#39;text&#39;]</code>。<br><sup>[<a href="#no-regexp-for-plaintext">link</a>]</sup></p>
</li>
<li><p><a name="regexp-string-index"></a><br>对于简单的构建操作，使用正则表达式作为索引即可。<br><sup>[<a href="#regexp-string-index">link</a>]</sup></p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">match = string[<span class="regexp">/regexp/</span>]             <span class="comment"># 获取匹配的内容</span></div><div class="line">first_group = string[<span class="regexp">/text(grp)/</span>, <span class="number">1</span>] <span class="comment"># 获取匹配的分组（grp）的内容</span></div><div class="line">string[<span class="regexp">/text (grp)/</span>, <span class="number">1</span>] = <span class="string">'replace'</span>  <span class="comment"># string =&gt; 'text replace'</span></div></pre></td></tr></table></figure>
</li>
<li><p><a name="non-capturing-regexp"></a><br>当你不需要分组结果时，使用非捕获组。<br><sup>[<a href="#non-capturing-regexp">link</a>]</sup></p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 差</span></div><div class="line">/(first<span class="params">|second)/</span></div><div class="line"></div><div class="line"># 好</div><div class="line">/(?:first|second)/</div></pre></td></tr></table></figure>
</li>
<li><p><a name="no-perl-regexp-last-matchers"></a><br>避免使用 Perl 风格的、用以代表最近的捕获组的特殊变量（比如 <code>$1</code>、<code>$2</code> 等）。使用 <code>Regexp.last_match(n)</code> 来替代。<br><sup>[<a href="#no-perl-regexp-last-matchers">link</a>]</sup></p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">/(regexp)/ =~ string</div><div class="line">...</div><div class="line"></div><div class="line"><span class="comment"># 差</span></div><div class="line">process $1</div><div class="line"></div><div class="line"><span class="comment"># 好</span></div><div class="line">process Regexp.last_match(<span class="number">1</span>)</div></pre></td></tr></table></figure>
</li>
<li><p><a name="no-numbered-regexes"></a><br>避免使用数字来获取分组。因为很难明白它们代表的含义。使用命名分组来替代。<br><sup>[<a href="#no-numbered-regexes">link</a>]</sup></p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 差</span></div><div class="line">/(regexp)/ =~ string</div><div class="line">...</div><div class="line">process Regexp.last_match(<span class="number">1</span>)</div><div class="line"></div><div class="line"><span class="comment"># 好</span></div><div class="line">/(?&lt;meaningful_var&gt;regexp)/ =~ string</div><div class="line">...</div><div class="line">process meaningful_var</div></pre></td></tr></table></figure>
</li>
<li><p><a name="limit-escapes"></a><br>在字符类别中，只有少数几个你需要特别关心的特殊字符：<code>^</code>、<code>-</code>、<code>\</code>、<code>]</code>，所以你不需要转义 <code>[]</code> 中的 <code>.</code> 与中括号。<br><sup>[<a href="#limit-escapes">link</a>]</sup></p>
</li>
<li><p><a name="caret-and-dollar-regexp"></a><br>小心使用 <code>^</code> 与 <code>$</code> ，它们匹配的是一行的开始与结束，而不是字符串的开始与结束。如果你想要匹配整个字符串，使用 <code>\A</code> 与 <code>\z</code>。(注意，<code>\Z</code> 实为 <code>/\n?\z/</code>)<br><sup>[<a href="#caret-and-dollar-regexp">link</a>]</sup></p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">string = <span class="string">"some injection\nusername"</span></div><div class="line">string[<span class="regexp">/^username$/</span>]   <span class="comment"># 匹配成功</span></div><div class="line">string[<span class="regexp">/\Ausername\z/</span>] <span class="comment"># 匹配失败</span></div></pre></td></tr></table></figure>
</li>
<li><p><a name="comment-regexes"></a><br>对于复杂的正则表达式，使用 <code>x</code> 修饰符。这种做法不但可以提高可读性，而且允许你加入必要的注释。注意的是，空白字符会被忽略。<br><sup>[<a href="#comment-regexes">link</a>]</sup></p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">regexp = /</div><div class="line">  start         # some text</div><div class="line">  \s            # white space char</div><div class="line">  (group)       # first group</div><div class="line">  (?:alt1|alt2) # some alternation</div><div class="line">  end</div><div class="line">/x</div></pre></td></tr></table></figure>
</li>
<li><p><a name="gsub-blocks"></a><br>对于复杂的替换，使用 <code>sub/gsub</code> 与哈希或区块组合的调用形式。<br><sup>[<a href="#gsub-blocks">link</a>]</sup></p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">words = <span class="string">'foo bar'</span></div><div class="line">words.sub(<span class="regexp">/f/</span>, <span class="string">'f'</span> =&gt; <span class="string">'F'</span>) <span class="comment"># =&gt; 'Foo bar'</span></div><div class="line">words.gsub(<span class="regexp">/\w+/</span>) &#123; <span class="params">|word|</span> word.capitalize &#125; <span class="comment"># =&gt; 'Foo Bar'</span></div></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="百分号字面量"><a href="#百分号字面量" class="headerlink" title="百分号字面量"></a>百分号字面量</h2><ul>
<li><p><a name="percent-q-shorthand"></a><br>只有当字符串中同时存在插值与双引号，且是单行时，才使用 <code>%()</code>（<code>%Q</code> 的简写形式）。多行字符串，倾向使用 heredocs。<br><sup>[<a href="#percent-q-shorthand">link</a>]</sup></p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 差 - 不存在插值</span></div><div class="line"><span class="string">%(&lt;div class="text"&gt;Some text&lt;/div&gt;)</span></div><div class="line"><span class="comment"># 应当使用 '&lt;div class="text"&gt;Some text&lt;/div&gt;'</span></div><div class="line"></div><div class="line"><span class="comment"># 差 - 不存在双引号</span></div><div class="line"><span class="string">%(This is <span class="subst">#&#123;quality&#125;</span> style)</span></div><div class="line"><span class="comment"># 应当使用 "This is #&#123;quality&#125; style"</span></div><div class="line"></div><div class="line"><span class="comment"># 差 - 多行字符串</span></div><div class="line"><span class="string">%(&lt;div&gt;\n&lt;span class="big"&gt;<span class="subst">#&#123;exclamation&#125;</span>&lt;/span&gt;\n&lt;/div&gt;)</span></div><div class="line"><span class="comment"># 应当使用 heredocs</span></div><div class="line"></div><div class="line"><span class="comment"># 好 - 同时存在插值与双引号，且是单行字符串</span></div><div class="line"><span class="string">%(&lt;tr&gt;&lt;td class="name"&gt;<span class="subst">#&#123;name&#125;</span>&lt;/td&gt;)</span></div></pre></td></tr></table></figure>
</li>
<li><p><a name="percent-q"></a><br>避免使用 <code>%q</code>，除非字符串同时存在 <code>&#39;</code> 与 <code>&quot;</code>。优先考虑更具可读性的常规字符串，除非字符串中存在大量需要转义的字符。<br><sup>[<a href="#percent-q">link</a>]</sup></p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 差</span></div><div class="line">name = <span class="string">%q(Bruce Wayne)</span></div><div class="line">time = <span class="string">%q(8 o'clock)</span></div><div class="line">question = <span class="string">%q("What did you say?")</span></div><div class="line"></div><div class="line"><span class="comment"># 好</span></div><div class="line">name = <span class="string">'Bruce Wayne'</span></div><div class="line">time = <span class="string">"8 o'clock"</span></div><div class="line">question = <span class="string">'"What did you say?"'</span></div><div class="line">quote = <span class="string">%q(&lt;p class='quote'&gt;"What did you say?"&lt;/p&gt;)</span></div></pre></td></tr></table></figure>
</li>
<li><p><a name="percent-r"></a><br>只有当正则表达式中存在一个或以上的 <code>/</code> 字符时，才使用 <code>%r</code>。<br><sup>[<a href="#percent-r">link</a>]</sup></p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"># 差</div><div class="line">%r&#123;\s+&#125;</div><div class="line"></div><div class="line"># 好</div><div class="line">%r&#123;^/(.*)$&#125;</div><div class="line">%r&#123;^/blog/2011/(.*)$&#125;</div></pre></td></tr></table></figure>
</li>
<li><p><a name="percent-x"></a><br>除非调用的命令使用了反引号（这种情况并不多见），否则不要使用 <code>%x</code>。<br><sup>[<a href="#percent-x">link</a>]</sup></p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 差</span></div><div class="line">date = <span class="string">%x(date)</span></div><div class="line"></div><div class="line"><span class="comment"># 好</span></div><div class="line">date = <span class="string">`date`</span></div><div class="line">echo = <span class="string">%x(echo `date`)</span></div></pre></td></tr></table></figure>
</li>
<li><p><a name="percent-s"></a><br>避免使用 <code>%s</code>。倾向使用 <code>:&quot;some string&quot;</code> 来创建含有空白字符的符号。<br><sup>[<a href="#percent-s">link</a>]</sup></p>
</li>
<li><p><a name="percent-literal-braces"></a><br>使用 <code>%</code> 字面量语法时，倾向使用 <code>()</code>（<code>%r</code> 除外，因为圆括号在正则表达式中比较常用，此时可以使用 <code>{}</code> 等其他形式来替代）。<br><sup>[<a href="#percent-literal-braces">link</a>]</sup></p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 差</span></div><div class="line"><span class="string">%w[one two three]</span></div><div class="line"><span class="string">%q&#123;"Test's king!", John said.&#125;</span></div><div class="line"></div><div class="line"><span class="comment"># 好</span></div><div class="line"><span class="string">%w(one two three)</span></div><div class="line"><span class="string">%q("Test's king!", John said.)</span></div></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="元编程"><a href="#元编程" class="headerlink" title="元编程"></a>元编程</h2><ul>
<li><p><a name="no-needless-metaprogramming"></a><br>避免无谓的元编程。<br><sup>[<a href="#no-needless-metaprogramming">link</a>]</sup></p>
</li>
<li><p><a name="no-monkey-patching"></a><br>当编写程序库时，不要使核心类混乱（不要使用 monkey patch）。<br><sup>[<a href="#no-monkey-patching">link</a>]</sup></p>
</li>
<li><p><a name="block-class-eval"></a><br>对于 <code>class_eval</code> 方法，倾向使用区块形式，而不是字符串插值形式。<br><sup>[<a href="#block-class-eval">link</a>]</sup></p>
<ul>
<li><p>当使用字符串插值形式时，总是提供 <code>__FILE__</code> 及 <code>__LINE__</code>，以使你的调用栈看起来具有意义：</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">class_eval <span class="string">'def use_relative_model_naming?; true; end'</span>, __FILE_<span class="number">_</span>, __LINE_<span class="number">_</span></div></pre></td></tr></table></figure>
</li>
<li><p>倾向使用 <code>define_method</code> 而不是 <code>class_eval { def ... }</code></p>
</li>
</ul>
</li>
<li><p><a name="eval-comment-docs"></a><br>当使用 <code>class_eval</code>（或其他的 <code>eval</code>）的字符串插值形式时，添加一个注释区块来说明它是如何工作的（来自 Rails 代码中的技巧）。<br><sup>[<a href="#eval-comment-docs">link</a>]</sup></p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 摘录自 activesupport/lib/active_support/core_ext/string/output_safety.rb</span></div><div class="line">UNSAFE_STRING_METHODS.each <span class="keyword">do</span> <span class="params">|unsafe_method|</span></div><div class="line">  <span class="keyword">if</span> <span class="string">'String'</span>.respond_to?(unsafe_method)</div><div class="line">    class_eval &lt;&lt;-EOT, __FILE_<span class="number">_</span>, __LINE_<span class="number">_</span> + <span class="number">1</span></div><div class="line">      <span class="function"><span class="keyword">def</span> <span class="comment">#&#123;unsafe_method&#125;(*params, &amp;block)       # def capitalize(*params, &amp;block)</span></span></div><div class="line">        to_str.<span class="comment">#&#123;unsafe_method&#125;(*params, &amp;block)  #   to_str.capitalize(*params, &amp;block)</span></div><div class="line">      <span class="keyword">end</span>                                         <span class="comment"># end</span></div><div class="line"></div><div class="line">      <span class="function"><span class="keyword">def</span> <span class="comment">#&#123;unsafe_method&#125;!(*params)              # def capitalize!(*params)</span></span></div><div class="line">        @dirty = <span class="literal">true</span>                             <span class="comment">#   <span class="doctag">@dirty</span> = true</span></div><div class="line">        <span class="keyword">super</span>                                     <span class="comment">#   super</span></div><div class="line">      <span class="keyword">end</span>                                         <span class="comment"># end</span></div><div class="line">    EOT</div><div class="line">  <span class="keyword">end</span></div><div class="line"><span class="keyword">end</span></div></pre></td></tr></table></figure>
</li>
<li><p><a name="no-method-missing"></a><br>避免使用 <code>method_missing</code>。它会使你的调用栈变得凌乱；其方法不被罗列在 <code>#methods</code> 中；拼错的方法可能会默默地工作（<code>nukes.launch_state = false</code>）。优先考虑使用委托、代理、或是 <code>define_method</code> 来替代。如果你必须使用 <code>method_missing</code> 的话，务必做到以下几点：<br><sup>[<a href="#no-method-missing">link</a>]</sup></p>
<ul>
<li>确保<a href="http://blog.marc-andre.ca/2010/11/methodmissing-politely.html" target="_blank" rel="external">同时定义了 <code>respond_to_missing?</code></a>。</li>
<li>仅仅捕获那些具有良好语义前缀的方法，像是 <code>find_by_*</code>——让你的代码愈确定愈好。</li>
<li>在语句的最后调用 <code>super</code>。</li>
<li><p>委托到确定的、非魔术的方法，比如：</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 差</span></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">method_missing?</span><span class="params">(meth, *params, &amp;block)</span></span></div><div class="line">  <span class="keyword">if</span> /^find_by<span class="number">_</span>(?&lt;prop&gt;.*)/ =~ meth</div><div class="line">    <span class="comment"># ... 一堆处理 find_by 的代码</span></div><div class="line">  <span class="keyword">else</span></div><div class="line">    <span class="keyword">super</span></div><div class="line">  <span class="keyword">end</span></div><div class="line"><span class="keyword">end</span></div><div class="line"></div><div class="line"><span class="comment"># 好</span></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">method_missing?</span><span class="params">(meth, *params, &amp;block)</span></span></div><div class="line">  <span class="keyword">if</span> /^find_by<span class="number">_</span>(?&lt;prop&gt;.*)/ =~ meth</div><div class="line">    find_by(prop, *params, &amp;block)</div><div class="line">  <span class="keyword">else</span></div><div class="line">    <span class="keyword">super</span></div><div class="line">  <span class="keyword">end</span></div><div class="line"><span class="keyword">end</span></div><div class="line"></div><div class="line"><span class="comment"># 最好的方式可能是在每个需要支持的属性被声明时，使用 define_method 定义对应的方法</span></div></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p><a name="prefer-public-send"></a><br>倾向使用 <code>public_send</code> 而不是 <code>send</code>，因为 <code>send</code> 会无视 <code>private/protected</code> 的可见性。<br><sup>[<a href="#prefer-public-send">link</a>]</sup></p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">module</span> <span class="title">Activatable</span></span></div><div class="line">  extend ActiveSupport::Concern</div><div class="line"></div><div class="line">  included <span class="keyword">do</span></div><div class="line">    before_create <span class="symbol">:create_token</span></div><div class="line">  <span class="keyword">end</span></div><div class="line"></div><div class="line">  private</div><div class="line"></div><div class="line">  <span class="function"><span class="keyword">def</span> <span class="title">reset_token</span></span></div><div class="line">    ...</div><div class="line">  <span class="keyword">end</span></div><div class="line"></div><div class="line">  <span class="function"><span class="keyword">def</span> <span class="title">create_token</span></span></div><div class="line">    ...</div><div class="line">  <span class="keyword">end</span></div><div class="line"></div><div class="line">  <span class="function"><span class="keyword">def</span> <span class="title">activate!</span></span></div><div class="line">    ...</div><div class="line">  <span class="keyword">end</span></div><div class="line"><span class="keyword">end</span></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Organization</span> &lt; ActiveRecord::Base</span></div><div class="line">  <span class="keyword">include</span> Activatable</div><div class="line"><span class="keyword">end</span></div><div class="line"></div><div class="line">linux_organization = Organization.find(...)</div><div class="line"></div><div class="line"><span class="comment"># 差 - 会破坏对象的封装性</span></div><div class="line">linux_organization.send(<span class="symbol">:reset_token</span>)</div><div class="line"></div><div class="line"><span class="comment"># 好 - 会抛出异常</span></div><div class="line">linux_organization.public_send(<span class="symbol">:reset_token</span>)</div></pre></td></tr></table></figure>
</li>
<li><p><a name="prefer-__send__"></a><br>倾向使用 <code>__send__</code> 而不是 <code>send</code>，因为 <code>send</code> 可能会被覆写。<br><sup>[<a href="#prefer-__send__">link</a>]</sup></p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">require</span> <span class="string">'socket'</span></div><div class="line"></div><div class="line">u1 = UDPSocket.new</div><div class="line">u1.bind(<span class="string">'127.0.0.1'</span>, <span class="number">4913</span>)</div><div class="line">u2 = UDPSocket.new</div><div class="line">u2.connect(<span class="string">'127.0.0.1'</span>, <span class="number">4913</span>)</div><div class="line"></div><div class="line"><span class="comment"># 这里不会调用 u2 的 sleep 方法，而是通过 UDP socket 发送一条消息</span></div><div class="line">u2.send <span class="symbol">:sleep</span>, <span class="number">0</span></div><div class="line"></div><div class="line"><span class="comment"># 动态调用 u2 的某个方法</span></div><div class="line">u2.__send_<span class="number">_</span> ...</div></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h2><ul>
<li><p><a name="always-warn"></a><br>总是开启 <code>ruby -w</code> 选项，以编写安全的代码。<br><sup>[<a href="#always-warn">link</a>]</sup></p>
</li>
<li><p><a name="no-optional-hash-params"></a><br>避免使用哈希作为可选参数。这个方法是不是做太多事了？（对象构造器除外）<br><sup>[<a href="#no-optional-hash-params">link</a>]</sup></p>
</li>
<li><p><a name="short-methods"></a><br>避免单个方法的长度超过 10 行（不计入空行）。理想上，大部分方法应当不超过 5 行。<br><sup>[<a href="#short-methods">link</a>]</sup></p>
</li>
<li><p><a name="too-many-params"></a><br>避免参数列表数目多于三或四个。<br><sup>[<a href="#too-many-params">link</a>]</sup></p>
</li>
<li><p><a name="private-global-methods"></a><br>如果你真的需要“全局”方法，将它们添加到 <code>Kernel</code> 并设为私有。<br><sup>[<a href="#private-global-methods">link</a>]</sup></p>
</li>
<li><p><a name="instance-vars"></a><br>使用模块实例变量而不是全局变量。<br><sup>[<a href="#instance-vars">link</a>]</sup></p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 差</span></div><div class="line">$foo_bar = <span class="number">1</span></div><div class="line"></div><div class="line"><span class="comment"># 好</span></div><div class="line"><span class="class"><span class="keyword">module</span> <span class="title">Foo</span></span></div><div class="line">  <span class="class"><span class="keyword">class</span> &lt;&lt; self</span></div><div class="line">    <span class="keyword">attr_accessor</span> <span class="symbol">:bar</span></div><div class="line">  <span class="keyword">end</span></div><div class="line"><span class="keyword">end</span></div><div class="line"></div><div class="line">Foo.bar = <span class="number">1</span></div></pre></td></tr></table></figure>
</li>
<li><p><a name="optionparser"></a><br>使用 <code>OptionParser</code> 来解析复杂的命令行选项。使用 <code>ruby -s</code> 来处理琐碎的命令行选项。<br><sup>[<a href="#optionparser">link</a>]</sup></p>
</li>
<li><p><a name="time-now"></a><br>使用 <code>Time.now</code> 而不是 <code>Time.new</code> 来获取当前的系统时间。<br><sup>[<a href="#time-now">link</a>]</sup></p>
</li>
<li><p><a name="functional-code"></a><br>使用函数式思维编写程序，避免副作用。<br><sup>[<a href="#functional-code">link</a>]</sup></p>
</li>
<li><p><a name="no-param-mutations"></a><br>不要修改参数值，除非那就是这个方法的作用。<br><sup>[<a href="#no-param-mutations">link</a>]</sup></p>
</li>
<li><p><a name="three-is-the-number-thou-shalt-count"></a><br>避免使用三层以上的嵌套区块。<br><sup>[<a href="#three-is-the-number-thou-shalt-count">link</a>]</sup></p>
</li>
<li><p><a name="be-consistent"></a><br>保持一致性。在理想的世界里，遵循这些准则。<br><sup>[<a href="#be-consistent">link</a>]</sup></p>
</li>
<li><p><a name="common-sense"></a><br>使用常识。<br><sup>[<a href="#common-sense">link</a>]</sup></p>
</li>
</ul>

      
    </div>

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/ruby/" rel="tag">#ruby</a>
          
            <a href="/tags/风格指南/" rel="tag">#风格指南</a>
          
        </div>
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2016/05/04/rails-minitest-写mocha/" rel="next" title="rails minitest 写mocha">
                <i class="fa fa-chevron-left"></i> rails minitest 写mocha
              </a>
            
          </div>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2016/05/21/ionic-加载app-页面空白解决方案/" rel="prev" title="ionic 加载app,页面空白解决方案">
                ionic 加载app,页面空白解决方案 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          
  <div class="comments" id="comments">
  <div class="ds-recent-visitors" data-num-items="28" data-avatar-size="42" id="ds-recent-visitors"></div>
    
      <div class="ds-thread" data-thread-key="2016/05/13/Ruby-编程风格指南/"
           data-title="Ruby 编程风格指南" data-url="http://peterfei.me/2016/05/13/Ruby-编程风格指南/">
      </div>
    
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap" >
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel ">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="https://ruby-china-files.b0.upaiyun.com/user/big_avatar/5575.jpg"
               alt="peterfei" />
          <p class="site-author-name" itemprop="name">peterfei</p>
          <p class="site-description motion-element" itemprop="description">peterfei|技术|上主是我的牧者</p>
        </div>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">79</span>
              <span class="site-state-item-name">日志</span>
            </a>
          </div>

          <div class="site-state-item site-state-categories">
            
              <span class="site-state-item-count">14</span>
              <span class="site-state-item-name">分类</span>
              
          </div>

          <div class="site-state-item site-state-tags">
            <a href="/tags">
              <span class="site-state-item-count">62</span>
              <span class="site-state-item-name">标签</span>
              </a>
          </div>

        </nav>

        
          <div class="feed-link motion-element">
            <a href="/atom.xml" rel="alternate">
              <i class="fa fa-rss"></i>
              RSS
            </a>
          </div>
        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/peterfei" target="_blank">
                  
                    <i class="fa fa-globe"></i> github
                  
                </a>
              </span>
            
          
        </div>

        
        

        <div class="links-of-author motion-element">
          
        </div>

      </section>

      
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc-indicator-top post-toc-indicator">
            <i class="fa fa-angle-double-up"></i>
          </div>
          <div class="post-toc">
            
              
            
            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#目录"><span class="nav-number">1.</span> <span class="nav-text">目录</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#源代码排版"><span class="nav-number">2.</span> <span class="nav-text">源代码排版</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#语法"><span class="nav-number">3.</span> <span class="nav-text">语法</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#命名"><span class="nav-number">4.</span> <span class="nav-text">命名</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#注释"><span class="nav-number">5.</span> <span class="nav-text">注释</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#注解"><span class="nav-number">5.1.</span> <span class="nav-text">注解</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#类与模块"><span class="nav-number">6.</span> <span class="nav-text">类与模块</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#异常"><span class="nav-number">7.</span> <span class="nav-text">异常</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#集合"><span class="nav-number">8.</span> <span class="nav-text">集合</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#数值"><span class="nav-number">9.</span> <span class="nav-text">数值</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#字符串"><span class="nav-number">10.</span> <span class="nav-text">字符串</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#正则表达式"><span class="nav-number">11.</span> <span class="nav-text">正则表达式</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#百分号字面量"><span class="nav-number">12.</span> <span class="nav-text">百分号字面量</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#元编程"><span class="nav-number">13.</span> <span class="nav-text">元编程</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#其他"><span class="nav-number">14.</span> <span class="nav-text">其他</span></a></li></ol></div>
            
          </div>
          <div class="post-toc-indicator-bottom post-toc-indicator">
            <i class="fa fa-angle-double-down"></i>
          </div>
        </section>
      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2025</span>
  <span class="with-love">
    <i class="icon-next-heart fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">peterfei</span>
</div>

<div class="powered-by">
  由 <a class="theme-link" href="http://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Mist
  </a>
</div>



      </div>
    </footer>

    <div class="back-to-top"></div>
  </div>

  


  



  <script type="text/javascript" src="/vendors/jquery/index.js?v=2.1.3"></script>

  <script type="text/javascript" src="/vendors/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  <script type="text/javascript" src="/vendors/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  <script type="text/javascript" src="/vendors/velocity/velocity.min.js"></script>

  <script type="text/javascript" src="/vendors/velocity/velocity.ui.min.js"></script>

  <script type="text/javascript" src="/vendors/fancybox/source/jquery.fancybox.pack.js"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.0.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.0.0"></script>



  
  

  
  
<script type="text/javascript" src="/js/src/scrollspy.js?v=5.0.0"></script>

<script type="text/javascript" id="sidebar.toc.highlight">
  $(document).ready(function () {
    var tocSelector = '.post-toc';
    var $tocSelector = $(tocSelector);
    var activeCurrentSelector = '.active-current';

    $tocSelector
      .on('activate.bs.scrollspy', function () {
        var $currentActiveElement = $(tocSelector + ' .active').last();

        removeCurrentActiveClass();
        $currentActiveElement.addClass('active-current');

        $tocSelector[0].scrollTop = $currentActiveElement.position().top;
      })
      .on('clear.bs.scrollspy', function () {
        removeCurrentActiveClass();
      });

    function removeCurrentActiveClass () {
      $(tocSelector + ' ' + activeCurrentSelector)
        .removeClass(activeCurrentSelector.substring(1));
    }

    function processTOC () {
      getTOCMaxHeight();
      toggleTOCOverflowIndicators();
    }

    function getTOCMaxHeight () {
      var height = $('.sidebar').height() -
                   $tocSelector.position().top -
                   $('.post-toc-indicator-bottom').height();

      $tocSelector.css('height', height);

      return height;
    }

    function toggleTOCOverflowIndicators () {
      tocOverflowIndicator(
        '.post-toc-indicator-top',
        $tocSelector.scrollTop() > 0 ? 'show' : 'hide'
      );

      tocOverflowIndicator(
        '.post-toc-indicator-bottom',
        $tocSelector.scrollTop() >= $tocSelector.find('ol').height() - $tocSelector.height() ? 'hide' : 'show'
      )
    }

    $(document).on('sidebar.motion.complete', function () {
      processTOC();
    });

    $('body').scrollspy({ target: tocSelector });
    $(window).on('resize', function () {
      if ( $('.sidebar').hasClass('sidebar-active') ) {
        processTOC();
      }
    });

    onScroll($tocSelector);

    function onScroll (element) {
      element.on('mousewheel DOMMouseScroll', function (event) {
          var oe = event.originalEvent;
          var delta = oe.wheelDelta || -oe.detail;

          this.scrollTop += ( delta < 0 ? 1 : -1 ) * 30;
          event.preventDefault();

          toggleTOCOverflowIndicators();
      });
    }

    function tocOverflowIndicator (indicator, action) {
      var $indicator = $(indicator);
      var opacity = action === 'show' ? 1 : 0;
      $indicator.velocity ?
        $indicator.velocity('stop').velocity({
          opacity: opacity
        }, { duration: 100 }) :
        $indicator.stop().animate({
          opacity: opacity
        }, 100);
    }

  });
</script>

<script type="text/javascript" id="sidebar.nav">
  $(document).ready(function () {
    var html = $('html');
    var TAB_ANIMATE_DURATION = 200;
    var hasVelocity = $.isFunction(html.velocity);

    $('.sidebar-nav li').on('click', function () {
      var item = $(this);
      var activeTabClassName = 'sidebar-nav-active';
      var activePanelClassName = 'sidebar-panel-active';
      if (item.hasClass(activeTabClassName)) {
        return;
      }

      var currentTarget = $('.' + activePanelClassName);
      var target = $('.' + item.data('target'));

      hasVelocity ?
        currentTarget.velocity('transition.slideUpOut', TAB_ANIMATE_DURATION, function () {
          target
            .velocity('stop')
            .velocity('transition.slideDownIn', TAB_ANIMATE_DURATION)
            .addClass(activePanelClassName);
        }) :
        currentTarget.animate({ opacity: 0 }, TAB_ANIMATE_DURATION, function () {
          currentTarget.hide();
          target
            .stop()
            .css({'opacity': 0, 'display': 'block'})
            .animate({ opacity: 1 }, TAB_ANIMATE_DURATION, function () {
              currentTarget.removeClass(activePanelClassName);
              target.addClass(activePanelClassName);
            });
        });

      item.siblings().removeClass(activeTabClassName);
      item.addClass(activeTabClassName);
    });

    $('.post-toc a').on('click', function (e) {
      e.preventDefault();
      var targetSelector = NexT.utils.escapeSelector(this.getAttribute('href'));
      var offset = $(targetSelector).offset().top;
      hasVelocity ?
        html.velocity('stop').velocity('scroll', {
          offset: offset  + 'px',
          mobileHA: false
        }) :
        $('html, body').stop().animate({
          scrollTop: offset
        }, 500);
    });

    // Expand sidebar on post detail page by default, when post has a toc.
    NexT.motion.middleWares.sidebar = function () {
      var $tocContent = $('.post-toc-content');

      if (CONFIG.sidebar === 'post') {
        if ($tocContent.length > 0 && $tocContent.html().trim().length > 0) {
          NexT.utils.displaySidebar();
        }
      }
    };
  });
</script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.0.0"></script>



  

  
    
  

  <script type="text/javascript">
    var duoshuoQuery = {short_name:"peterfei"};
    (function() {
      var ds = document.createElement('script');
      ds.type = 'text/javascript';ds.async = true;
      ds.id = 'duoshuo-script';
      ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
      ds.charset = 'UTF-8';
      (document.getElementsByTagName('head')[0]
      || document.getElementsByTagName('body')[0]).appendChild(ds);
    })();
  </script>

  
    
  





  
  

  
  


</body>
</html>
